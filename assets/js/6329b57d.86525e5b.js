(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{104:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return d}));var r=t(0),a=t.n(r);function c(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){c(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=a.a.createContext({}),b=function(e){var n=a.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=b(e.components);return a.a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},m=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,c=e.originalType,o=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),p=b(t),m=r,d=p["".concat(o,".").concat(m)]||p[m]||u[m]||c;return t?a.a.createElement(d,s(s({ref:n},l),{},{components:t})):a.a.createElement(d,s({ref:n},l))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var c=t.length,o=new Array(c);o[0]=m;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var l=2;l<c;l++)o[l]=t[l];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},80:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return c})),t.d(n,"metadata",(function(){return o})),t.d(n,"toc",(function(){return s})),t.d(n,"default",(function(){return l}));var r=t(3),a=(t(0),t(104));const c={title:"\u6d88\u606f\u4e2d\u5fc3"},o={unversionedId:"\u77e5\u8bc6\u4e0e\u6280\u80fd\u70b9/\u6d88\u606f\u4e2d\u5fc3/\u6d88\u606f\u4e2d\u5fc3",id:"\u77e5\u8bc6\u4e0e\u6280\u80fd\u70b9/\u6d88\u606f\u4e2d\u5fc3/\u6d88\u606f\u4e2d\u5fc3",isDocsHomePage:!1,title:"\u6d88\u606f\u4e2d\u5fc3",description:"\u4ee5\u5728vue\u4e2d\u4f7f\u7528\u4e3a\u4f8b",source:"@site/docs/\u77e5\u8bc6\u4e0e\u6280\u80fd\u70b9/\u6d88\u606f\u4e2d\u5fc3/\u6d88\u606f\u4e2d\u5fc3.md",slug:"/\u77e5\u8bc6\u4e0e\u6280\u80fd\u70b9/\u6d88\u606f\u4e2d\u5fc3/\u6d88\u606f\u4e2d\u5fc3",permalink:"/zh-summary/docs/\u77e5\u8bc6\u4e0e\u6280\u80fd\u70b9/\u6d88\u606f\u4e2d\u5fc3/\u6d88\u606f\u4e2d\u5fc3",editUrl:"https://github.com/qinzhihao-conghua/docs/\u77e5\u8bc6\u4e0e\u6280\u80fd\u70b9/\u6d88\u606f\u4e2d\u5fc3/\u6d88\u606f\u4e2d\u5fc3.md",version:"current",sidebar:"docs",previous:{title:"react\u5b66\u4e60\u7b14\u8bb0",permalink:"/zh-summary/docs/react/react\u5b66\u4e60\u7b14\u8bb0"},next:{title:"bpmn-js\u4f7f\u7528",permalink:"/zh-summary/docs/\u77e5\u8bc6\u4e0e\u6280\u80fd\u70b9/bpmn-js\u4f7f\u7528/bpmn-js\u4f7f\u7528"}},s=[{value:"MessageCenter\u90e8\u5206",id:"messagecenter\u90e8\u5206",children:[]},{value:"ReWebSocketService\u90e8\u5206",id:"rewebsocketservice\u90e8\u5206",children:[]}],i={toc:s};function l(e){let{components:n,...t}=e;return Object(a.b)("wrapper",Object(r.a)({},i,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("p",null,"\u4ee5\u5728vue\u4e2d\u4f7f\u7528\u4e3a\u4f8b"),Object(a.b)("h2",{id:"messagecenter\u90e8\u5206"},"MessageCenter\u90e8\u5206"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"MessageCenter"),"\u7684\u5b9e\u73b0\u5176\u5b9e\u662f\u5bf9",Object(a.b)("inlineCode",{parentName:"p"},"mitt"),"\u5e93\u7684\u7b80\u5355\u5c01\u88c5\uff0c\u5982\u679c\u4e0d\u4f9d\u8d56\u5e93\u5219\u9700\u8981\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5728vue\u4e2d\u901a\u5e38\u88ab\u79f0\u4e4b\u4e3a\u4e8b\u4ef6\u603b\u7ebf\uff0cEventBus"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-shell"},"npm i mitt\n")),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"MessageCenter.ts"),"\u5185\u5bb9"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},'import mitt from "mitt";\nconst MessageCenter = mitt();\nexport default MessageCenter;\n')),Object(a.b)("p",null,"\u4f7f\u7528\uff0c\u4e0eangular\u4e2d\u7684\u6d88\u606f\u4e2d\u5fc3\u5dee\u4e0d\u591a\uff0c\u9700\u8981",Object(a.b)("strong",{parentName:"p"},"\u6307\u5b9a\u4e8b\u4ef6\u540d\u79f0")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"\u5728",Object(a.b)("inlineCode",{parentName:"li"},"main.ts"),"\u91cc\u5f15\u5165",Object(a.b)("inlineCode",{parentName:"li"},"MessageCenter.ts"))),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},"import MessageCenter from './api/message-center';\n")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"\u5728\u9875\u9762\u4efb\u4f55\u4f4d\u7f6e\u5f15\u5165\u5e76\u901a\u8fc7",Object(a.b)("inlineCode",{parentName:"li"},"emit"),"\u53d1\u9001\u6d88\u606f")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},"import MessageCenter from '../../api/message-center';\nfunction sentMessageByMitt() {\n  MessageCenter.emit('globalMessage', { code: '1111', name: 'demo\u7ec4\u4ef6\u53d1\u51fa\u7684' })\n}\n")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"\u5728\u9875\u9762\u4efb\u4f55\u4f4d\u7f6e\u5f15\u5165\u5e76\u901a\u8fc7",Object(a.b)("inlineCode",{parentName:"li"},"on"),"\u63a5\u6536\u6d88\u606f")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},"import MessageCenter from './api/message-center';\nMessageCenter.on('globalMessage', (data) => {\n   console.log('-----', data);\n})\n")),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"\u6ce8\u610f\uff0c\u5728\u4e0d\u9700\u8981\u7684\u65f6\u5019\u8bf7\u5c06\u8ba2\u9605\u5173\u95ed\uff0c\u9632\u6b62\u51fa\u73b0\u5185\u5b58\u6ea2\u51fa")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},"onUnmounted(() => {\n  MessageCenter.off('globalMessage')\n})\n")),Object(a.b)("h2",{id:"rewebsocketservice\u90e8\u5206"},"ReWebSocketService\u90e8\u5206"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"ReWebSocketService"),"\u662f\u5bf9",Object(a.b)("inlineCode",{parentName:"p"},"reconnecting-websocket"),"\u7684\u7b80\u5355\u5c01\u88c5\uff0c\u7531\u4e8e\u5728\u5c01\u88c5\u539f\u751fwebsocket\u4e2d\u5bf9\u670d\u52a1\u65ad\u5f00\u91cd\u8fde\u4e4b\u540e\uff0c\u6682\u65e0\u601d\u8def\u5904\u7406\u8fde\u63a5\u6539\u53d8\u65e0\u6cd5\u63a5\u6536\u5230\u6d88\u606f\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u91c7\u7528\u4e86",Object(a.b)("inlineCode",{parentName:"p"},"reconnecting-websocket"),"\u3002"),Object(a.b)("p",null,"websocket\u7684\u4f7f\u7528\u4e3b\u8981\u8fd8\u662f\u4f9d\u8d56\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u5176\u6b21\u7ea6\u5b9a\u524d\u540e\u7aef\u4ea4\u4e92\u6570\u636e\u683c\u5f0f"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"\u524d\u7aef\u4f7f\u7528")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},"import { ReWebSocketService } from '../../api/re-web-socket-service';\n/**\u4ea4\u4e92\u7684\u6570\u636e\u683c\u5f0f */\ninterface WebSocketMsg {\n  /**\u4f20\u5165ip\u5219\u6839\u636eip\u53d1\u6d88\u606f\uff0c\u5426\u5219\u5e7f\u64ad */\n  ip?: Array<string>,\n  /**\u540c\u4e2aip\uff0c\u591a\u4e2a\u8d26\u6237\u8bf7\u4f20\u5165 */\n  userName?: string,\n  data: any\n}\n// \u63a5\u6536\u5230\u6d88\u606f\u65f6\u7684\u56de\u8c03\nconst messageCallback = (e) => {\n  console.log('\u63a5\u6536websocket\u6d88\u606f', e)\n}\n// new \u5bf9\u8c61\u65f6\u5019\u6839\u636e\u9700\u8981\u4f20\u5165\u5bf9\u5e94\u65f6\u95f4\u7684\u56de\u8c03\u51fd\u6570openCallback, messageCallback, errorCallback, closeCallback\nconst reWebSocketService: ReWebSocketService = new ReWebSocketService('ws://192.168.12.106:3001', {\n  messageCallback: messageCallback\n});\n// \u4e0d\u9700\u8981\u7684\u65f6\u5019\u5c06\u8fde\u63a5\u65ad\u5f00\uff0c\u907f\u514d\u5185\u5b58\u6ea2\u51fa\nonUnmounted(() => {\n  reWebSocketService.websocket.close();\n})\n// \u53d1\u9001\u6d88\u606f\nfunction sentMessageBywebsocket() {\n  const data: WebSocketMsg = {\n    ip: ['192.168.12.110'],// \u4f20\u5165ip\u5219\u8868\u793a\u5355\u64ad\n    data: '\u6765\u81ea106\u7684\u6d88\u606f'\n  }\n  reWebSocketService.websocket.send(JSON.stringify(data))\n}\n")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"\u540e\u7aef\u670d\u52a1\uff0c\u8fd9\u91cc\u7528node.js\u5b9e\u73b0\uff0c\u5177\u4f53\u9879\u76ee\u6709\u7ec4\u957f\u51b3\u5b9a")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-javascript"},'const ws = require("nodejs-websocket")\n\nlet count=0;\nconst server = ws.createServer(function (conn) {\n    count++;\n    console.log("\u6709\u65b0\u7684\u8fde\u63a5"+count);\n    const ipAndPort=conn.headers.origin.substring(7).split(\':\');\n    conn.userName=\'\u7528\u6237\'+count;\n    conn.ip=ipAndPort[0];\n    conn.port=ipAndPort[1];\n    // \u6709\u8fde\u63a5\u65f6\u5e7f\u64ad\u901a\u77e5\n    broadcast({count:count,currUserIp:ipAndPort[0],currUserName:conn.userName,data:\'\u767b\u5f55\u6210\u529f\'});\n    conn.on("text",  (data)=> {\n        const result=JSON.parse(data);\n        if(result&&result.ip){// \u6709ip\u5219\u5355\u64ad\n            server.connections.forEach(conn=>{\n                result.ip.forEach(ip=>{\n                    if(conn.ip===ip){\n                        conn.sendText(JSON.stringify({\n                            count:count,\n                            currUserIp:ipAndPort[0],\n                            currUserName:conn.userName,\n                            data:result.data\n                        }))\n                    }\n                })\n            })\n        }else{\n            broadcast({count:count,currUserIp:ipAndPort[0],currUserName:conn.userName,data:result.data});\n        }\n    })\n    conn.on("close",  (code, reason)=> {\n        console.log("\u6709\u4eba\u5173\u95ed");\n        count--;\n        // broadcast(\'gunabi\')\n    })\n    conn.on("error", (err)=> {\n        console.log(err, "\u8fde\u63a5\u62a5\u9519");\n    });\n}).listen(3001,()=>console.log(\'\u670d\u52a1\u542f\u52a8\u6210\u529f\uff0c\u7aef\u53e33001\'));\n/**\u5e7f\u64ad */\nfunction broadcast(data) {\n    server.connections.forEach( (connection) =>{\n        connection.sendText(JSON.stringify(data));\n    })\n}\n')))}l.isMDXComponent=!0}}]);