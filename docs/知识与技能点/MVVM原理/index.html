<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-知识与技能点/MVVM原理/MVVM原理" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">MVVM原理 | 博客系统</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zh-summary.github.io/zh-summary/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://zh-summary.github.io/zh-summary/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://zh-summary.github.io/zh-summary/docs/知识与技能点/MVVM原理/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MVVM原理 | 博客系统"><meta data-rh="true" name="description" content="作者：chenhongdong"><meta data-rh="true" property="og:description" content="作者：chenhongdong"><link data-rh="true" rel="icon" href="/zh-summary/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zh-summary.github.io/zh-summary/docs/知识与技能点/MVVM原理/"><link data-rh="true" rel="alternate" href="https://zh-summary.github.io/zh-summary/docs/知识与技能点/MVVM原理/" hreflang="en"><link data-rh="true" rel="alternate" href="https://zh-summary.github.io/zh-summary/docs/知识与技能点/MVVM原理/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh-summary/blog/rss.xml" title="不要葱花 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-summary/blog/atom.xml" title="不要葱花 Atom Feed"><link rel="stylesheet" href="/zh-summary/assets/css/styles.26432fa5.css">
<script src="/zh-summary/assets/js/runtime~main.54cd3b0b.js" defer="defer"></script>
<script src="/zh-summary/assets/js/main.6c122b97.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-summary/"><div class="navbar__logo"><img src="/zh-summary/img/logo.jpg" alt="不要葱花 Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh-summary/img/logo.jpg" alt="不要葱花 Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">不要葱花</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-summary/docs/">文档</a><a class="navbar__item navbar__link" href="/zh-summary/blog">Blog</a><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-summary/docs/">angular</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-summary/docs/react/react学习笔记">react</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-summary/docs/sql笔记/">sql笔记</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-summary/docs/vue/VUE-webpack方式的注意事项/">vue</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-summary/docs/杂文/中国从哪里来/">杂文</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/zh-summary/docs/知识与技能点/JavaScript手册/">知识与技能点</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/JavaScript手册/">JavaScript手册</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-summary/docs/知识与技能点/MVVM原理/">MVVM原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/SpringDataJPA/">SpringDataJPA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/apk反编译/">apk反编译</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/bpmn-js使用/">bpmn-js使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/css世界小结/">css世界小结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/excel导出/">excel导出</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/fiddler抓包Android应用/">fiddler抓包Android应用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/github静态网站/">github静态网站</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/nginx配置/">nginx配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/office2016激活/">office2016激活</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/ueditor使用过程/">ueditor使用过程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/vue与angular性能差异/">vue与angular性能差异原因</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/window相关/">window相关</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/前端水印/">前端水印</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/前端理论知识/">前端理论知识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/字体分包/">字体分包</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/树形结构/">树形结构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/消息中心/">消息中心</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/观察者模式/">观察者模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/视频流处理/">视频流处理</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/zh-summary/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">知识与技能点</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MVVM原理</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>MVVM原理</h1></header><blockquote>
<p>作者：chenhongdong</p>
<p><a href="https://juejin.im/post/5abdd6f6f265da23793c4458" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5abdd6f6f265da23793c4458</a></p>
</blockquote>
<p>今天花上 10 分钟，针对 MVVM 这个面试必考点，简简单单的来给大家划一下重难点</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="划重点">划重点<a href="#划重点" class="hash-link" aria-label="Direct link to 划重点" title="Direct link to 划重点">​</a></h2>
<p>MVVM 双向数据绑定 在Angular1.x版本的时候通过的是<strong>脏值检测</strong>来处理</p>
<p>而现在无论是React还是Vue还是最新的Angular，其实实现方式都更相近了</p>
<p>那就是通过<strong>数据劫持+发布订阅模式</strong></p>
<p>真正实现其实靠的也是ES5中提供的<code>Object.defineProperty</code>，当然这是不兼容的所以Vue等只支持了IE8+</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么是它">为什么是它<a href="#为什么是它" class="hash-link" aria-label="Direct link to 为什么是它" title="Direct link to 为什么是它">​</a></h3>
<p><code>Object.defineProperty()</code>说实在的我们大家在开发中确实用的不多，多数是修改内部特性，不过就是定义对象上的属性和值么？干嘛搞的这么费劲(纯属个人想法)</p>
<p>But在实现框架or库的时候却发挥了大用场了，这个就不多说了，只不过轻舟一片而已，还没到写库的实力</p>
<p><strong>知其然要知其所以然，来看看如何使用</strong></p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> obj </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> song </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;发如雪&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">singer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;周杰伦&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">defineProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;music&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 1. value: &#x27;七里香&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">configurable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// 2. 可以配置对象，删除属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// writable: true,         // 3. 可以修改对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">enumerable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 4. 可以枚举</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ☆ get,set设置时不能设置writable和value，它们代替了二者且是互斥的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// 5. 获取obj.music的时候就会调用get方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> song</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 6. 将修改的值重新赋给song</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        song </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 下面打印的部分分别是对应代码写入顺序执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// {singer: &#x27;周杰伦&#x27;, music: &#x27;七里香&#x27;}  // 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">delete</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">music</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 如果想对obj里的属性进行删除，configurable要设为true  2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 此时为  {singer: &#x27;周杰伦&#x27;}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">music</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;听妈妈的话&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 如果想对obj的属性进行修改，writable要设为true  3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// {singer: &#x27;周杰伦&#x27;, music: &quot;听妈妈的话&quot;}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> key </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 默认情况下通过defineProperty定义的属性是不能被枚举(遍历)的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 需要设置enumerable为true才可以</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 不然你是拿不到music这个属性的，你只能拿到singer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// singer, music    4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">music</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// &#x27;发如雪&#x27;  5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">music</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;夜曲&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">// 调用set设置新的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">music</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// &#x27;夜曲&#x27;    6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上是关于Object.defineProperty的用法</p>
<p>下面我们来写个实例看看，这里我们以Vue为参照去实现怎么写MVVM</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">app</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">{{song}}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">h1</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">《{{album.name}}》是{{singer}}2005年11月发行的专辑</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">主打歌为{{album.theme}}</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">作词人为{{singer}}等人。</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        为你弹奏肖邦的{{album.theme}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--实现的mvvm--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">mvvm.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 写法和Vue一样</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript keyword" style="color:#00009f">let</span><span class="token script language-javascript"> mvvm </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:#00009f">new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">Mvvm</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">            </span><span class="token script language-javascript literal-property property" style="color:#36acaa">el</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&#x27;#app&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">            </span><span class="token script language-javascript literal-property property" style="color:#36acaa">data</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript">     </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// Object.defineProperty(obj, &#x27;song&#x27;, &#x27;发如雪&#x27;);</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">                </span><span class="token script language-javascript literal-property property" style="color:#36acaa">song</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&#x27;发如雪&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">                </span><span class="token script language-javascript literal-property property" style="color:#36acaa">album</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style="color:#36acaa">name</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&#x27;十一月的萧邦&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">                    </span><span class="token script language-javascript literal-property property" style="color:#36acaa">theme</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&#x27;夜曲&#x27;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">                </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">                </span><span class="token script language-javascript literal-property property" style="color:#36acaa">singer</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&#x27;周杰伦&#x27;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">            </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上面是html里的写法，相信用过Vue的同学并不陌生</p>
<p>那么现在就开始实现一个自己的MVVM吧</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="打造mvvm">打造MVVM<a href="#打造mvvm" class="hash-link" aria-label="Direct link to 打造MVVM" title="Direct link to 打造MVVM">​</a></h2>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 创建一个Mvvm构造函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 这里用es6方法将options赋一个初始值，防止没传，等同于options || {}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Mvvm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">options </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// vm.$options Vue上是将所有属性挂载到上面</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 所以我们也同样实现,将所有属性挂载到了$options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$options</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// this._data 这里也和Vue一样</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">_data</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 数据劫持</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据劫持">数据劫持<a href="#数据劫持" class="hash-link" aria-label="Direct link to 数据劫持" title="Direct link to 数据劫持">​</a></h3>
<p>为什么要做数据劫持？</p>
<ul>
<li>观察对象，给对象增加Object.defineProperty</li>
<li>vue特点是不能新增不存在的属性 不存在的属性没有get和set</li>
<li>深度响应 因为每次赋予一个新对象时会给这个新对象增加defineProperty(数据劫持)</li>
</ul>
<p>多说无益，一起看代码</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 创建一个Observe构造函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 写数据劫持的主要逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 所谓数据劫持就是给对象增加get,set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 先遍历一遍对象再说</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> key </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// 把data属性通过defineProperty的方式定义属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 递归继续向下找，实现深度的数据劫持</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">defineProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">configurable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newVal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 更改值的时候</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> newVal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 设置的值和以前值一样就不理它</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newVal</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 如果以后再获取值(get)的时候，将刚才设置的值再返回  去</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newVal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 当设置为新值后，也需要把新值再去定义成属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 外面再写一个函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 不用每次调用都写个new</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 也方便递归调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 如果不是对象的话就直接return掉</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 防止递归溢出</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">data </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;object&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上代码就实现了数据劫持，不过可能也有些疑惑的地方比如：递归</p>
<p>再来细说一下为什么递归吧，看这个栗子</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> mvvm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Mvvm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">el</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;#app&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">b</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">c</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们在控制台里看下</p>
<p><img decoding="async" loading="lazy" alt="1" src="data:image/jpeg;base64,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" width="361" height="269" class="img_ev3q"></p>
<p>被标记的地方就是通过**递归observe(val)**进行数据劫持添加上了<code>get</code>和<code>set</code>，递归继续向a里面的对象去定义属性，亲测通过可放心食用</p>
<p>接下来说一下<code>observe(newVal)</code>这里为什么也要递归</p>
<p>还是在可爱的控制台上，敲下这么一段代码 <code>mvvm._data.a = {b:&#x27;ok&#x27;}</code></p>
<p>然后继续看图说话</p>
<p><img decoding="async" loading="lazy" alt="2" src="data:image/jpeg;base64,UklGRiIcAABXRUJQVlA4IBYcAADQcwCdASo5AesAPpFEnUqlo6Kho5H7sLASCWVu4WhA/p1dmKGAbnpyDG+Ds6+hr9Rby7zFfsz+yHvM+kL+x+oB/ev8Z1lX7kewB+0HpzeyF/a/+v+5HtP///WZfH/9T7Sf7f4g+JzzJ7X+rh/X+ETq7zR/k/2h/Zf3jzh/wX23ehfyX/vfUF/Kv5B/mP7L5FuwrzzzBfYn55/sP8H+T3oV/znoP+hf3H/e+4D/PP7D/0fWj/p+Cn557Af8u/uf/O/xn5IfS5/Qf+X/Q+e79B/zX/v/1PwDfy7+q/9T/D+2X///c3+7nsgfuF//yYaz4VF4rqynVIrJKJx1x7oo6vdDAuAWd3rSb9gwKL2yR2wg/uBGJSaqbsNhsNJSlGuoLApjrGy3F9isAMcf+U4ldCCBFgqN286rbPuv1+v18bgkx+b2yDUULfO4LFM7s7nbg7cH2QFiRxjsxx31U3YbDYbDRhz6mvmeVk/tk5KsRdyHcGw2Gw16YuRd4GnzQcnd1s57L/yeNG2tjtBqavV0k0NyPoUCJxdfr9fr9PNqIH82ZGwQPkKuR9yIlY6QnjqBSceUudUNmC9xME/psu2no39ptULecinPumw2Gw0g7Ax3R8RnFN7bmH3QqG9J4djEdF820zsCB4RDJXsKTUzUCkTDyI41VFYGzFfPCK0y+68gBrDvOPHHnwMkBpNtVi4BUr7xz50RXK2d7o5tddunB54881ETQ3ao9C2bWWoxD6TYcBIhtTHHaCMrEtuhmy4qTSieuDiWRhsIXcVm5n++4oTBTX+stxDvfVIT+4f7xQ6p0ij2jNV5roSh/AaBmf2gLLl584++ZjUzvPXV0gi43s/3HqQwlATOoinEwXWoMQnkm2E1jSWf3Q2t9NMAMEp8s0bb+bFs0x3unQXvFRbY2vE8xj5VXSUYWCK5nVs+w177ns2P/nSRWmE4LpBHE+a8rZQ1/q6caoqxBP83CUON3JSzEE2OKmqZFEFjFjCD0mG0+oJuB1AIFGg2nu9o0CXkATio6eO20H36J/5rE7783/z51L30kihVA7lPOBUDdN/pclEjZb1XXzuEKC2ceoFan2SYWbET34iHaK+wmTltJVpDNnDPxfpcJ7/EQI9hBrrzcVKPXXTGbrRjAarmQCvacLuQiM557O495LZUhyVBjvlKE0VDKTSLWSQn1XBtLNnyNKFyBXLfojL0xVuhyzWGI9sz+xFsFMmjY5GjRmpbNMvuv1+v1+v0wAD+4aSTgoOVbUJD0RHj44VcI7hX0nTl3qEw6IkCtP8iAKRokmfBVfo/YeeMxCF2UUreABv6acXhMp9wotozRyCiVcBB8nwL6sZwKss0TkIT4yAqe/3mTquP9jddK/SmYhT3AD/b04Uk5EVmNmAhCr+7JZsKYg/zdTXNHOkL6+UKihqChHW1sIzRj9edZG+5cdvrRhzSl4SkZxfEtPypDMgIMHc2YDVHKDLNejvw5pvQ8TcWHt3+wrDROV/n+rRt8I7Wd2N/sPpnw0LE8qbwT8Jn9LVqMzBRuMqUjQdL/I5xYStKF9xf+Bo0qrBDi347fZuih9yYWha5311hOVApaYNlxvLoevH6OLsVuZkyBsww7hOQhrQxsv9syFA8CK7Rsj6GO6cDN4PYmjQX5fIE+43BFWw5p1Q3+iIOgoWZ9mib5P9jgXm2EnZy8L1/Z7Aa6GS74VqQ/+PifYARJB/C00BEZyJ1lxhrkgHo2dRZmj9+uVBe7QUEgArnCIHTY31KTFRWoKnbcq3QNCaZgsTrQ7ea5+7sZEFAknenmRumPK33MsfD5je1imwePns4hAdGZgVV7mgYIH3tc81geJ1BFsapsrNCMzxXkZohXf2/LT+foQ1i9Khhckut4EagNodK5o5gsR9V1RqOlqW0bA7rZYAa1bws1LxLm4Bp9KJKd3ShNLJ9ot+LzbbnSdKnFOcnFSiCxUaV8NqNrEnKOqrhcbz6ih1p6IEfvNsYxkwnLqr0sFc5Ch+CFt2vh1NwMgHWx8JgK73u0SzZgp4e0zm6rjz6h8y6lWiWo4PQZAl5CRDYWWZFyWPZ59/INR0lj74u8cFojG2dL9lt1cPMwUB+p875IqoZiFBdo9umZGNSI5apZ5BSLVpbOFuZ39K1+pNdpaLM3j2swCRL/l27PdLtRC1uYZ7zIFfTVMkGRiKqXbMJxiQ4j0rjjTEIk8gcbscMw7nS81SHMssxB6/ght6oWtYC1dKY7vAqWzpibQ7GXC37wUgztF4Sb36SsSNqrBR2D9xSEHxHA/3H9u6O8Q0N1F418tp3kGpE9WPUiKk/tcKt7MrQl6f9fwxv+T6Ul8nGTjeuzDaAO46t2p9HfC+xKbhZIm4cxgcmMTeJ7Y6adrguj+SyWPPATeg1sB/3iewoCAIoGXbKfxIni7dtgV/9kGwVlqaTVxLHLS2fPR3qaqoq+Feem9LkCAp2I/WUw/GTPcS7Z3kc9HH/lGwnbWYaWQJ3pLboTkMV1dfpOpIAJGJ9syKdAWFbo2fOGbhW8gGyIoGShDGefQK/u1iUvXXhfR6LFHyEJ9J/VmyIz+TGAiunw0Q2Zp/rcU3zn/HzDiXE9Cb847dIyG2+nH0D+K8nyjXZhi9zNvGq7kcw3BFWw5hrQ6AfaMPFzxQPbpL67JZuD7NmH9DWM++mF6eNetNYjO4GWrlWb0tO0yWJYwb6gjvV97OwTOFUVAVYu/7bei0PFUOBVZodytAS9AcyCu1p8JxHs8nUpE/zCEt4mo97J76FNJTxf6bGcOYaun5JB6nfiQ8uZB77/XlQAW8E5YpS27TD6J3oJ0fi5OO/jBuaGudDUj/ce87AuY8Cb3ipH58doqbDW7+SYqQ7F1CaThOhaaggP7n461qd/2T4Q5Yr+jdsdCI4278NVaKXymcMWfXG3x3pLWJJqAkgHySYpz8rV4u8TaJzeHTtPC6q45hT/Q+25ixdrceeJGvo5FYk58PqR3p3hh2pThSkio78bWRpyyyyBgNqTeGCZlql1QX12e5szvsVO+LKMIQrFIhsgV1iX0JAa2agOr17Wkcudr82Q+CjHtH6pHyEJ9J/VmyIz+TGAiunw0Qr0FWtIq4mS8mS5Cv9ND5ATQVI5QhIKZ6BixCAKNfmhyWui/F6uChPTAL8tDgVe7sv3/MqPiZueyMN02hGOIeBMqa2Jehb4bqxunvTiRvdrtp2sHYK38tMs2I8v9VIYBv/6W2ka9C+LwTXCRWl0WKWDAE7uupU4f7AW5hJjSxHg2Ty4gcpiESn3pKcJHckAe+4ziPZ5LJAv8Yua/uejlLhaxiHr2v1PadmHebAvnBtkn3+vKgAt4I3vPzY2aX1KW3YKbGjZV/GDc0Nc6GpH+4954Swu+gV9evcrBgVXlKLRhOhaagfieZcQn1Y8mdZhkxz0frwvIBCs0VXW0N3iIH2l0KCG25V9Db/for2R4EQzTNexJt724JJb0BDV0OpbOz91XS2t6icShynxSPVH0ptqS4qsRncA2Uh2BUo3EbZh8f/yWSo0AM2XX9TyRdFbcIHC4QM225BdpxcoH/0NlR2b5iPbxI05NGdbT3Dvaj4WnikBGCpZf5HfphIEXcl7QlU+caigcQkbemLAjXYUmC1FsJB6qB5L2tss5Rl9GoZuHQY5J3zXOMD+edhRq1LqorlpahXk5cuSwPeQ34sAhjNxjuT+a8yh9naxeuYHJ07si0qiGpSmGfxGN+ROEG1TXhBTED+R8ZZ52b3PctzJ0UaHGOgIyHrsuB0bdnjL5nfCEazhHxkC28bdSnmR8o7Lnsf62qirmXN7+3RGnz3EiyR3ylq7tpchnjUp9ms5TUI23o1XYbln/Sn/EoT+2p8u3JUPcp6b6adresLtg3jJxqGH4JmAxKfCOOOZp1CIaBt7/U5uCS9XQyk0vOXe92eegPdOOSuvB3XgWm3AdbRM9C7pIGdHkKN7B6/HOpCYIb7ZQ/2cASd23zzQ+SWD309GSzjRbH0ZfR4e0+VJstusifoZZnUj6gyYbBeXYTbC1rx+29HYuQOU9kMETEP022REkfiEWnccNSBFo8Wi57yQvZfIFr+B//OWtntLr+MnLMkGLgulYLrzNu+iPp7vfVGH6dhCkcQy2XtJeqib7nrvaEZ72YTbYQ9ZNOqPHqBppj+72PlkY4VCabNr+iiqeHFE2iZGTJ+3qeQC8hWKY+Nzb88qqokMmpJAja+cI+k5r69rydjZe6dUT7/ozENCACuMLxKFr43YFgAqKa8al1UDcRWCsP5yMLkj8RagNLdjeiKxnjaZ2aDnGPWgu+ut7bpuDThIxNU259mmb+isVYYuQawcTJbeMZl1oVLBcW3GfDnzGey4buYM5BgJOKtMsqg5XT7OjgZ9z+mMYdFLDq3Qz9fo06Oi/O7xr2uR2HHwKLmPzZyebE3O6ks1y2zpa/BNhRcyz61TCdSKHD8PQWBMpJp27BS9kx2I3yO0cYOw/hT4PbGvykFVdZ7K/fMcg52ZyPuBSi5soiTnIizORQKuCym/pAYucCSs9Kt/8Hmj+4iq1tOHF3+1ShBYw+N1VzOl+4oRO7yhvnL8CKctbA8iZ/Bg98O6iH/wVNJXsRy/Bjcj4I9rVOzWRI53djVdzKhs5/37dtqJwWznM7Zblw/38fv8Zvn7FIR9V5r0u6/pvemy4hbuI6kXqo9DCja8wuMoHS4UdQ4TjCf912g+3ECk2pX1jqBUrSeoUwSjBM3BP3wxBXyjegBssPLIkZjmPv99aXCe/61VDBGywpwENy4+J/S2R0cfywokWfq/jA5ywXoPNwxo5IzVybZ+xRcC26JQ15bVtfWPQFVBroO9wGlk1dDWM2+rVeXqj7f6wddiKcHcwXwaU0DKdGkJygPtGe77wP28nL3VhUGWIAzk4RP/Z+VYCTqcxM0Qoz6HG9uIY0BEAWHxPhfHhUn5AJ9s8wwU8Zq+/+ek/VAtfzt1knTrDCAdyJIBIhyR9X4adulA3Q8j3lXX0W64mUU3rkP+Bwj/bV0s/jnpW6nHLjaNNFEt5d5aBLbkyiZy0CXoBY2g8/FelazKxZ5j19qMlzms2nG4J2k3rX2rsRwu9hNGAgOCqd7gp33z2nvqPOA0A6QWghJ8Nfr2bv6848GsBtGPPBTwB4X0seFZPXmY43eo8EdXjteUP+mKpSJRBYiCuCwzj3WAyb4g9BLEF5yvKfkke81Ho3biYHpfRYUzgLL2pUPxKjY7935jKF+mfwH6mU7xXhY52X18AyfcfQXVnTfiUG94fiulqBtR7y3+nbnUP+NZimMiKM92IzUT8Su61e3dzMaqOGg+UiS2J324pmrGSYUt1KEcqhAcXXo/hhZ6VyNCNUB5p3r2/deG84AA7N8sZMYnOWXY2eVUv6mXhQHiwshxmvb8mcy95pv2bpPVzeimv+S4MNRKYhT/3+518rsUMZJHMyQJPhzjJxnImN/8/kC4l29EEG+MiGtB05vDhAq0dHREjvvdO+RuyrKGU77arqNjXRScm05lLAzFunmEbkGGUTOapTGQE3MKA58MDLUiQyvzDFXMBIZpKuogRy2iX04KHRFWiX58ks6hOxn7Z0+rEuurMpRJ0R7vS4Jnp2VCi85kzfBJo2rFX+Ons9Qj1vyaAp1Yw1oCIuI2bHQwxJrsGL2/r9x0ZzXELai9IBHvAcYz7vhii2050Rnwbk18l+QQIIQR58rkYoVc3sUaidUMQzXKnn+5dl6eviiaQH0y3ThoCqUvLTlg7I0QrSpzD4KPq476mV9sy3JXm3O3K7E+wm0ymt9m4nz7jh8UtNdtv5yxoSERX0t1WgNphGWJ7PuP/LerWCpuENVbdkj74tk+Bgg4/gWl7GveXtk/nOyYhnY6gvANHz3DD13G2/WTAQJBdnb2s5i93hbcn8nffxltJfxUn9iRmpzj4ZczXU7wVsvbtLXqZkrF0rGfcwWU6oPd2YxYcpENe4nwptC9hBK8fV/fc2oaZRzxHM7Z/yqmlKaF8h4HJSJxNwo25OZgAUE6HOdRUKzfZn+5g8E5NzzLJ+XboY24zcr+u3oZU2XuP2OGqd/uzD3u5yIXsQjDitnbjuoIDWp6GoYAs7FW+o6DL6NenkMv7lSA3NilEY7mggDRsXXg+XLjk7FlQoc6zTOFGaE1TBOclWcgAwVb1GtOwegOIooYmSxV2+VQ5IjH0XgPKcK4rRuO7+h84/bdT3qVpu64ECsuqCjEJ5+Fg2IJEyziRERgU1xW/QUsOxWK2gBXEwNWne1bYTb/4DIfz2Zmp5moUTfckTjLrY52HpZNTjPC6Rl930S2gQJ36sFrDIFKeXolcaVR60Wtn1ZJMn5ItCv0OyAHWoxqE9Y96GHCSMt28MSGUKVou5OHtEKVdloYU3tZj6glfPKiixfxrpIwbTStj7xGNrxvtSIV+YIO1hIN7s39sxWhzFHML/zBZ2PF8tjkrQcMIqnvS+Q0yT2Zl6O/DB07gvzAhrKttVKMLDbas2hpLCDg1mWY17Sczb4kpd0XM3kDW9hst/fF//hY7peRxDhIMwRsKWetWXZ77ac9+Ax3UNT+bZm7qzqhxwzTWrRWgSXuKq8aSSHAd1YHofxOZnHweJiaxjy+VDy3CrH9N1wAigq0vS5dfg8jLngQB6RR1Hn7XFn13FZV/kgCKm7nZtI/jRgY7ftUukhUfJls7+62/DZ15M5jHF50Jf5GEbGLLaprgMdkKEEbTWfbgMKqOnvzLOWcmCAuVqKmGraI6o2cSEV8/8AA+yEBaD3cIXyDKLD/qM7RrhGt5eVQRyqqtssD7slYIGZy1GatqrQzKxz9l3naOb+KnFxd96zrPmQqEa1BcVzh65d9vgNB2r5J6OwIwd8q93yQH2/8zkMvFIXQpzHxg/rQDgQCWV5NUJdSKwT4B4iGjut4GOCH6D4MgHAWNe+kdft45t5eelSlgDeC/Evnd7e7iYcUKlYehD88AND/nPyThVSL8K06zjlH8dFf1F4xaufPbTnYPZWOxxfO5S/YRb+2fbTeyn4hb9fZ6sV58Cs5IbyAsfMKKNzvrlcJF2XspEiGHtWoEdMN4yThhYzOfqyVZ3jVNs8RKMfUAKFovT/rLA+hy44iAb+gQfDbeUh879+CcPCXClj7UqI5z+uy9gydiytqWj8JyDJO0NeE3/faigjESQn1VAXVOz4GgPLgcO0lDudprVCqGCXNqureZIRUz7EkzHZ4am2L7VxQoXlPE9KCCQE4m1AWzAPSmxQogVSFO64Ed5Sat9bPP0ku143AMR0kMrUsKpX4CUsRYEByMVU9kOGFvNmxB6N3PYvB/PLE2qny/maGwI+ENXyjLA2Jut4Ajt7Haq9f36zwCSb4Fz6W0/6VTXLok/Nw4KQ+RxbvNAC8GauEJZ2SmomC7fd4ZUUdZk6TeW3BSxoPUtXlTLOnSHE/SwTR/ClhqzlCy4HECkjEisd5HQKzy5Ejziu5HFgrkI0iYT9+XPEW70NBtTiBXDBCqnMg6/JXNvgzFeX6s5kDvM1EfdNY3FZ73fY6XC9Xxs2eqF6VSML0hvB1b6kIzQHYOLwOwmUesXxd/Iw8pTEgkZcjsjEbXwrUInToAnWhnPB3ZySZQhaeovDZ6S/K1t2iXkd5OUSjZMf3FSk0P4cE7mMeMFVncLZJJOfbn6lkRwCda1Aum9eZ9QFl3A+xEKlwEQK/CMh7LUhCMUIXiaX8Hg1Tx1Xl6PXNad8H/8fZ9PScOHN9reLgnCu8qCcSmbbWb9pdxMaaz2IE5XB4y5UKzBfpyskscRZCP/m+ziiobopXPvsztbxcjte9WDhjT0ZHenRq53pahQOkD2+GLZe3cjsyWdzTuN9Reazxy+/ET1ATJ8va6ZNowtC+b3ZHA6azTiP1a+cNfijKBH9tzszs/CBeW+gEXQzJFE4D0YGBgotEsftf3+eVdOwkFWRRKcB/TALANgL88MAoYySfOFMp89LqOn+7TepnAOb/8DDPQmo+d49SDd0EPpKNM0jC1fvJ3MaGfztwgACo+gTW4PetlQAxXUGBN2s3KWQ2uw6TvogogAB5ZOeNXUs1ROKFzATwBQ+71HBZ9UVqExNHCBQVwG8FfkhMU/ENjYipcRsa8ntbfZGReiOwyHnO0U67ZXGIiOLo/RiM3gJ9p8ioRWdGlsd3JcdQ38OY9CypSQU09jLkyA+PertBmNnDfixR9SJLRN5HAvEUaUvxrzpnv/pI68re4LeGo6HCtxpKklioPgFHVc9ChbcVHUjgzMzYtrDb6sXWk++G+oBRw9FoyuqIBBgDRhOkqi9TKafBJfTXlbXacCmT0J2XkrbAs8EHTFYq/ZsNTBwwcoOTBtp+RjBUtwIzmRTzreXO+1oM5MxhyvE7rrqVUuj+8Oktn7UmD//S/Qgn/+lqkQHupy8JLcPSWTWGswsx0H1ostHzOhroYEG/XQt4Ko0PIWs6/LL7Hro24s+ugSoywi8Is541Sva71spXN5nie8UqgLZbv7h5abbvV/v6WD4b3v//x2/6scbah+/9FOywsfJiJ5S7OyNoykL31lj6d8yudEtuWRNYAlX5h1E4lXGMH7HvP5hVd5hXP+ZmcLJpd1tc6k2bfuQqVQg9lwsIm4JPlcV2+3/CUQSrcOXVGmjaIG3f3bYU6AAgOm//fb0NFnktE7u7HCBGWoGCoQTCNcUzMvGc3c3MTzkJgpUfoZhC/y66Bs7kRcScrdAeu/XdwJFGA+DCiANzX2uIWSRST3DbZuMk2uy/+/4Y8DBf9oHKN/EU2dsEqaJhoY0/u5QWB+FY/2fJR/OIAWQA7yRqrjiWYFEmg2lgrUsdq6MGy/0lLzIUeEw3DiKofktv5EPDefxwhUH5ioXWlfClXeMWLN5B7yQIoG7NtWo5atX4RlmgGhvPiMwYRwAryOe2nn9XQqX5pRGsTuTFRjkPpTwtFIGCi8TI6dpsrunck3S80qVu84APZg7sk1UwnEV0xakq3HD3ISxIvoI5Jdvnu1CnJUsXsWmAqqCwhBcP+XSJBLwJJUQhSgpCo+pZMELYev7cGCxSuz5DffC7Gj/Vhss2Af8f3cXl8og5Q4GjA1KficNWfpoOQvvEpcvXD2cPwHqc86Au9u910Prjx+3NPcplb/R+A85pl29AMawY20HnQM/LdcO7TpkxT/KasmsT2M5FAe09CwwwwupHN+GXoeHrY/0X2YQEbqBVFFtx4y1/egay4W5sMpSAO2fnl+oFdFZJMwMui0uh2YOqQ40u0aFSTloOF6mnua+IIEDrEgw2r3s4OfMuYgelYXGBv2fC0FK1tTdxkV/m1QUqSHxkNzFmTm5v9FpS5zn4lkpDVpdI/X0NWl0j9QriUx/HI0RCsW9ZcWcGcUiPPBHi5sasgO9L/xTObTj8XDXDHK+bMLTuRYru1mVvJG+4uQZkWQi/9ftaPSrxJTpppopSN0Rd7kZtaxTPpRBWJA32U4xILwNXCAtDSTH8JtmMjek/rWeNPbx7iNhYGKAuMH4pMJ12HRQGNrvv4eu194fUAAG7p4+i8QyzavtLS65utOY/b9mRGGzK7l/v+wNEA8lrFQzS6pLTp95P+7EGsXAIyDT+laQAHflwAAAAA==" width="313" height="235" class="img_ev3q"></p>
<p>通过<code>observe(newVal)</code>加上了</p>
<p><img decoding="async" loading="lazy" alt="3" src="data:image/jpeg;base64,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" width="303" height="259" class="img_ev3q"></p>
<p>现在大致明白了为什么要对设置的新值也进行递归observe了吧，哈哈，so easy</p>
<p>数据劫持已完成，我们再做个数据代理</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据代理">数据代理<a href="#数据代理" class="hash-link" aria-label="Direct link to 数据代理" title="Direct link to 数据代理">​</a></h3>
<p>数据代理就是让我们每次拿data里的数据时，不用每次都写一长串，如mvvm._data.a.b这种，我们其实可以直接写成mvvm.a.b这种显而易见的方式</p>
<p>下面继续看下去，+号表示实现部分</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Mvvm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">options </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 数据劫持</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// this 代理了this._data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> key </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">defineProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">configurable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// 如this.a = {b: 1}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newVal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newVal</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 此时就可以简化写法了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mvvm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mvvm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">b</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ok&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mvvm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// &#x27;ok&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>写到这里数据劫持和数据代理都实现了，那么接下来就需要编译一下了，把<code>{{}}</code>里面的内容解析出来</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据编译">数据编译<a href="#数据编译" class="hash-link" aria-label="Direct link to 数据编译" title="Direct link to 数据编译">​</a></h3>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Mvvm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">options </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// observe(data);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 编译    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">el</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 创建Compile构造函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> vm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 将el挂载到实例上方便调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$el</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">querySelector</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">el</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 在el范围里将内容都拿到，当然不能一个一个的拿</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 可以选择移到内存中去然后放入文档碎片中，节省开销</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fragment </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createDocumentFragment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">child </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">firstChild</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fragment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">child</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 此时将el中的内容放入内存中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 对el里面的内容进行替换</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">frag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frag</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childNodes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">node</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> txt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">textContent</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> reg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex special-escape escape" style="color:#36acaa">\{</span><span class="token regex regex-source language-regex special-escape escape" style="color:#36acaa">\{</span><span class="token regex regex-source language-regex group punctuation" style="color:#393A34">(</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">.</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">*?</span><span class="token regex regex-source language-regex group punctuation" style="color:#393A34">)</span><span class="token regex regex-source language-regex special-escape escape" style="color:#36acaa">\}</span><span class="token regex regex-source language-regex special-escape escape" style="color:#36acaa">\}</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">g</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 正则匹配{{}}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">nodeType</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> reg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">txt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 即是文本节点又有大括号的情况{{}}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token known-class-name class-name">RegExp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 匹配到的第一个分组 如：a.b, c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> arr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">RegExp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vm</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                arr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// 如this.a.b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 用trim方法去除一下首尾空格</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">textContent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> txt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 如果还有子节点，继续递归replace</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childNodes</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childNodes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fragment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 替换内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$el</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fragment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 再将文档碎片放入el中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>看到这里在面试中已经可以初露锋芒了，那就一鼓作气，做事做全套，来个一条龙</p>
<p>现在数据已经可以编译了，但是我们手动修改后的数据并没有在页面上发生改变</p>
<p>下面我们就来看看怎么处理，其实这里就用到了特别常见的设计模式，发布订阅模式</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="发布订阅">发布订阅<a href="#发布订阅" class="hash-link" aria-label="Direct link to 发布订阅" title="Direct link to 发布订阅">​</a></h3>
<p>发布订阅主要靠的就是数组关系，订阅就是放入函数，发布就是让数组里的函数执行</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 发布订阅模式  订阅和发布 如[fn1, fn2, fn3]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Dep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 一个数组(存放函数的事件池)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">subs</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Dep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">addSub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">sub</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">subs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sub</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">notify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 绑定的方法，都有一个update方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">subs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">sub</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> sub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 监听函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 通过Watcher这个类创建的实例，都拥有update方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Watcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fn</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 将fn放到实例上</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">Watcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">update</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> watcher </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Watcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">111</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> dep </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Dep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addSub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">watcher</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 将watcher放到数组中,watcher自带update方法， =&gt; [watcher]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addSub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">watcher</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">notify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">//  111, 111</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据更新视图">数据更新视图<a href="#数据更新视图" class="hash-link" aria-label="Direct link to 数据更新视图" title="Direct link to 数据更新视图">​</a></h3>
<ul>
<li>现在我们要订阅一个事件，当数据改变需要重新刷新视图，这就需要在replace替换的逻辑里来处理</li>
<li>通过<code>new Watcher</code>把数据订阅一下，数据一变就执行改变内容的操作</li>
</ul>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">frag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 省略...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 替换的逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">textContent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> txt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 监听变化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 给Watcher再添加两个参数， 用来取新的值(newVal)给回调函数传参</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Watcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token known-class-name class-name">RegExp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">newVal</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">textContent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> txt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> newVal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">trim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 重写Watcher构造函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Watcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">vm</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> exp</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> fn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">fn</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fn</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">vm</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vm</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> exp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 添加一个事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 这里我们先定义一个属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token maybe-class-name">Dep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> arr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> exp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vm</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   arr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 取值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">      val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// 获取到this.a.b，默认就会调用get方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token maybe-class-name">Dep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当获取值的时候就会自动调用get方法，于是我们去找一下数据劫持那里的get方法</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> dep </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Dep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 省略...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">defineProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">           </span><span class="token maybe-class-name">Dep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> dep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addSub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Dep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 将watcher添加到订阅事件中 [watcher]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newVal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> newVal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newVal</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">observe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newVal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">           dep</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">notify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 让所有watcher的update方法执行即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当<code>set</code>修改值的时候执行了<code>dep.notify</code>方法，这个方法是执行<code>watcher</code>的<code>update</code> 方法，那么我们再对<code>update</code>进行修改一下</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">Watcher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">update</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// notify的时候值已经更改了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 再通过vm, exp来获取新的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> arr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">vm</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   arr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">       val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 通过get获取到新的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 将每次拿到的新值去替换{{}}的内容即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在我们数据的更改可以修改视图了，这很good，还剩最后一点，我们再来看看面试常考的双向数据绑定吧</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="双向数据绑定">双向数据绑定<a href="#双向数据绑定" class="hash-link" aria-label="Direct link to 双向数据绑定" title="Direct link to 双向数据绑定">​</a></h3>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// html结构</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">input v</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">model</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;c&quot;</span><span class="token plain"> type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;text&quot;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 数据部分</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">b</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">c</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">frag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 省略...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">       </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">nodeType</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 元素节点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> nodeAttr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">attributes</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 获取dom上的所有属性,是个类数组</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token known-class-name class-name">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">nodeAttr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">attr</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> attr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// v-model  type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> exp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> attr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// c        text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">includes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;v-&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vm</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">exp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// this.c 为 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 监听变化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Watcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">newVal</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newVal</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 当watcher触发时会自动将内容放进输入框中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;input&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> newVal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> e</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// 相当于给this.c赋了一个新值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// 而值的改变会调用set，set中又会调用notify，notify中调用watcher的update方法实现了更新</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    vm</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">exp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newVal</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childNodes</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">childNodes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>大功告成，面试问Vue的东西不过就是这个罢了，什么双向数据绑定怎么实现的，问的一点心意都没有，差评！！！</p>
<p>大官人请留步，本来应该收手了，可临时起意(手痒)，再写点功能吧，再加个computed(计算属性)和mounted(钩子函数)吧</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">computed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">计算属性</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mounted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">钩子函数</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// html结构</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">p</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">求和的值是</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">sum</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">p</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">b</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">computed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">a</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">noop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">mounted</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">setTimeout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;所有事情都搞定了&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Mvvm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">options </span><span class="token parameter operator" style="color:#393A34">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#393A34">{</span><span class="token parameter punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 初始化computed,将this指向实例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">       initComputed</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 编译</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">el</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 所有事情处理好后执行mounted钩子函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">+</span><span class="token plain">       options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">mounted</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 这就实现了mounted钩子函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initComputed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> vm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> computed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">computed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 从options上拿到computed属性   {sum: ƒ, noop: ƒ}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 得到的都是对象的key可以通过Object.keys转化为数组</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">keys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">computed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">key</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// key就是sum,noop</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">defineProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 这里判断是computed里的key是对象还是函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 如果是函数直接就会调get方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 如果是对象的话，手动调一下get方法即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 如：sum() {return this.a + this.b;},他们获取a和b的值就会调用get方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 所以不需要new Watcher去监听变化了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">get</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> computed</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;function&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> computed</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> computed</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">get</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>写了这些内容也不算少了，最后做一个形式上的总结吧</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>通过自己实现的<code>mvvm</code>一共包含了以下东西</p>
<ul>
<li>通过Object.defineProperty的get和set进行数据劫持</li>
<li>通过遍历data数据进行数据代理到this上</li>
<li>通过<code>{{}}</code>对数据进行编译</li>
<li>通过发布订阅模式实现数据与视图同步</li>
<li>通过通过通过，收了，感谢  大官人的留步了</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="补充">补充<a href="#补充" class="hash-link" aria-label="Direct link to 补充" title="Direct link to 补充">​</a></h2>
<p>针对以上代码在实现编译的时候还是会有一些小bug，再次经过研究和高人指点，完善了编译，下面请看修改后的代码</p>
<p><strong>修复</strong>：两个相邻的<code>{{}}</code>正则匹配，后一个不能正确编译成对应的文本，如<code>{{album.name}}</code> <code>{{singer}}</code></p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">el</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> vm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 省略...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">frag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 省略...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">nodeType</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> reg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">txt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">replaceTxt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">textContent</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> txt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">matched</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> placeholder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">placeholder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 匹配到的分组 如：song, album.name, singer...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Watcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> placeholder</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> replaceTxt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 监听变化，进行匹配替换内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> placeholder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">val</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 替换</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">replaceTxt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上面代码主要实现依赖的是<code>reduce</code>方法，<code>reduce</code> 为数组中的每一个元素依次执行回调函数</p>
<p>如果还有不太清楚的，那我们单独抽出来reduce这部分再看一下</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 将匹配到的每一个值都进行split分割</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 如:&#x27;song&#x27;.split(&#x27;.&#x27;) =&gt; [&#x27;song&#x27;] =&gt; [&#x27;song&#x27;].reduce((val, key) =&gt; val[key]) </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 其实就是将vm传给val做初始值，reduce执行一次回调返回一个值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// vm[&#x27;song&#x27;] =&gt; &#x27;周杰伦&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 上面不够深入，我们再来看一个</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 再如：&#x27;album.name&#x27;.split(&#x27;.&#x27;) =&gt; [&#x27;album&#x27;, &#x27;name&#x27;] =&gt; [&#x27;album&#x27;, &#x27;name&#x27;].reduce((val, key) =&gt; val[key])</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 这里vm还是做为初始值传给val，进行第一次调用，返回的是vm[&#x27;album&#x27;]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 然后将返回的vm[&#x27;album&#x27;]这个对象传给下一次调用的val</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 最后就变成了vm[&#x27;album&#x27;][&#x27;name&#x27;] =&gt; &#x27;十一月的萧邦&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> placeholder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">val</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> vm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>reduce</code>的用处多多，比如计算数组求和是比较普通的方法了，还有一种比较好用的妙处是可以进行二维数组的展平(flatten)，各位不妨来看最后一眼</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> arr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> flatten </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">previous</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> current</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> previous</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flatten</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [1, 2, 3, 4, 5, 6]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ES6中也可以利用...展开运算符来实现的，实现思路一样，只是写法更精简了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flatten </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arr</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">reduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">a</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flatten</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// [1, 2, 3, 4, 5, 6]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/qinzhihao-conghua/docs/知识与技能点/MVVM原理/MVVM原理.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-summary/docs/知识与技能点/JavaScript手册/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">JavaScript手册</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-summary/docs/知识与技能点/SpringDataJPA/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SpringDataJPA</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#划重点" class="table-of-contents__link toc-highlight">划重点</a><ul><li><a href="#为什么是它" class="table-of-contents__link toc-highlight">为什么是它</a></li></ul></li><li><a href="#打造mvvm" class="table-of-contents__link toc-highlight">打造MVVM</a><ul><li><a href="#数据劫持" class="table-of-contents__link toc-highlight">数据劫持</a></li><li><a href="#数据代理" class="table-of-contents__link toc-highlight">数据代理</a></li><li><a href="#数据编译" class="table-of-contents__link toc-highlight">数据编译</a></li><li><a href="#发布订阅" class="table-of-contents__link toc-highlight">发布订阅</a></li><li><a href="#数据更新视图" class="table-of-contents__link toc-highlight">数据更新视图</a></li><li><a href="#双向数据绑定" class="table-of-contents__link toc-highlight">双向数据绑定</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li><li><a href="#补充" class="table-of-contents__link toc-highlight">补充</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 不要葱花博客 Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>