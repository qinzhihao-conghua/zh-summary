<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-知识与技能点/SpringDataJPA/SpringDataJPA" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">SpringDataJPA | 博客系统</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://zh-summary.github.io/zh-summary/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://zh-summary.github.io/zh-summary/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://zh-summary.github.io/zh-summary/docs/知识与技能点/SpringDataJPA/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SpringDataJPA | 博客系统"><meta data-rh="true" name="description" content="1.入门概念"><meta data-rh="true" property="og:description" content="1.入门概念"><link data-rh="true" rel="icon" href="/zh-summary/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://zh-summary.github.io/zh-summary/docs/知识与技能点/SpringDataJPA/"><link data-rh="true" rel="alternate" href="https://zh-summary.github.io/zh-summary/docs/知识与技能点/SpringDataJPA/" hreflang="en"><link data-rh="true" rel="alternate" href="https://zh-summary.github.io/zh-summary/docs/知识与技能点/SpringDataJPA/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh-summary/blog/rss.xml" title="不要葱花 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-summary/blog/atom.xml" title="不要葱花 Atom Feed"><link rel="stylesheet" href="/zh-summary/assets/css/styles.26432fa5.css">
<script src="/zh-summary/assets/js/runtime~main.eceebcca.js" defer="defer"></script>
<script src="/zh-summary/assets/js/main.a4397f0f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-summary/"><div class="navbar__logo"><img src="/zh-summary/img/logo.jpg" alt="不要葱花 Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh-summary/img/logo.jpg" alt="不要葱花 Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">不要葱花</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-summary/docs/">文档</a><a class="navbar__item navbar__link" href="/zh-summary/blog">Blog</a><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-summary/docs/">angular</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-summary/docs/react/react学习笔记">react</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-summary/docs/sql笔记/">sql笔记</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-summary/docs/vue/VUE-webpack方式的注意事项/">vue</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-summary/docs/杂文/中国从哪里来/">杂文</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/zh-summary/docs/知识与技能点/JavaScript手册/">知识与技能点</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/JavaScript手册/">JavaScript手册</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/MVVM原理/">MVVM原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/Prompt提示词/">Prompt提示词</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-summary/docs/知识与技能点/SpringDataJPA/">SpringDataJPA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/apk反编译/">apk反编译</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/bpmn-js使用/">bpmn-js使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/css世界小结/">css世界小结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/css九宫格核心代码/">css九宫格核心代码</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/css高级技术赏析/">css高级技术赏析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/excel导出/">excel导出</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/fiddler抓包Android应用/">fiddler抓包Android应用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/github静态网站/">github静态网站</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/nginx配置/">nginx配置</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/office2016激活/">office2016激活</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/table固定表头/">table固定表头</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/ueditor使用过程/">ueditor使用过程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/vue与angular性能差异/">vue与angular性能差异原因</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/window相关/">window相关</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/关闭浏览器当前选项卡/">关闭浏览器当前选项卡</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/前端水印/">前端水印</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/前端理论知识/">前端理论知识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/发布订阅模式/">发布订阅模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/字体分包/">字体分包</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/树形结构/">树形结构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/浏览器通知/">浏览器通知</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/消息中心/">消息中心</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/观察者模式/">观察者模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-summary/docs/知识与技能点/视频流处理/">视频流处理</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/zh-summary/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">知识与技能点</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">SpringDataJPA</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>SpringDataJPA-开篇</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1入门概念">1.入门概念<a href="#1入门概念" class="hash-link" aria-label="Direct link to 1.入门概念" title="Direct link to 1.入门概念">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11什么是jpa">1.1什么是JPA<a href="#11什么是jpa" class="hash-link" aria-label="Direct link to 1.1什么是JPA" title="Direct link to 1.1什么是JPA">​</a></h3>
<p>JPA 是&quot;Java Persistence Api&quot;简称，中文译作&quot;Java 持久化编程接口&quot;，Java EE8开始重命名&quot;JakartaPersistence Api&quot;;
JPA并不是一个框架而是一个规范，知名的 Hibernate 便是JPA的一个具体实现;Spring DataJPA是Spring框架提供的一种数据库访问的方式，是在 Hibermate 基础之上的封装实现</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12为什么需要jpa">1.2为什么需要JPA<a href="#12为什么需要jpa" class="hash-link" aria-label="Direct link to 1.2为什么需要JPA" title="Direct link to 1.2为什么需要JPA">​</a></h3>
<p>对比知名的 MyBatis(莲城的老李 MyBatis)，JPA优点表现在:</p>
<ol>
<li>
<p>自动生成SQL语句，减少了开发工作量</p>
</li>
<li>
<p>与spring集成良好</p>
</li>
<li>
<p>JPA统一了不同数据库的访问方式，使得所采用的数据库可自由切换</p>
</li>
</ol>
<p>总结<!-- -->:JPA<!-- -->适合快速开发、简单的CRUD操作的项目</p>
<p>引入lombok 依赖</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="初始化">初始化<a href="#初始化" class="hash-link" aria-label="Direct link to 初始化" title="Direct link to 初始化">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-applicationyml">2.2 application.yml<a href="#22-applicationyml" class="hash-link" aria-label="Direct link to 2.2 application.yml" title="Direct link to 2.2 application.yml">​</a></h3>
<p>数据源配置</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 数据源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url:jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306/jpa_db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.alibaba.druid.pool.DruidDataSource</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23创建库表">2.3创建库表<a href="#23创建库表" class="hash-link" aria-label="Direct link to 2.3创建库表" title="Direct link to 2.3创建库表">​</a></h3>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">--使用jpa_db数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> jpa_db</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--删除已存在的库表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exists</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--创建存款类型表(tbl_deposit)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> tbl_deposit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    saving_id </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">auto_increment</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token string" style="color:#e3116c">&#x27;存款类型id&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    saving_name </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token string" style="color:#e3116c">&#x27;存款类型名&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    descrip </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token string" style="color:#e3116c">&#x27;存款类型描述&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">primary</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">saving_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--存款类型表(tbl_deposit)测试数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">saving_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">descrip</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;活期&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;按存款日结算利息&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">saving_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">descrip</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;定期一年&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;存款期是1年&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">saving_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">descrip</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;定期二年&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;存款期是2年&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">saving_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">descrip</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;定期三年&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;存款期是3年&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">saving_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;定活两便&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">saving_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">descrip</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;零存整取一年&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;存款期是1年&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">saving name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">descrip</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;零存整取二年&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;存款期是2年&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">saving_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">descrip</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;零存整取三年&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;存款期是3年&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">saving_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">descrip</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;存本取息五年&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;按月支取利息&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--查看表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tbl_deposit</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24创建实体类">2.4创建实体类<a href="#24创建实体类" class="hash-link" aria-label="Direct link to 2.4创建实体类" title="Direct link to 2.4创建实体类">​</a></h3>
<p>此处仅描述&quot;用户实体类&quot;的创建，作入门举例。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AllArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@NoArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Entity(name = &quot;tbl_deposit&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Deposit{ //未指定name属性，默认的表名是类名(小写)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;saving_id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer savingId; //存款类型id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name =&quot;saving_name&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string savingName; //存款类型名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string descrip; //存款类型描述</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意事项:</p>
<ol>
<li>
<p>@Entity 注解用于标识 Java 实体类与数据库表的映射关系，name 属性用于标识库中的表名。不指定则使用实体类名(小写)作为表名进行映射;</p>
</li>
<li>
<p>@Id 注解用于标识表的主键与实体的哪个屈性产生映射关系;</p>
</li>
<li>
<p>@Column   注解用于标识表的字段与实体属性的映射关系，name 属性用于标识表的字段名;</p>
</li>
<li>
<p>SpringDataJPA 无需任何配置自动完成从下划线到驼峰命名的转换。</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-自定义jpa操作接口">2.5 自定义JPA操作接口<a href="#25-自定义jpa操作接口" class="hash-link" aria-label="Direct link to 2.5 自定义JPA操作接口" title="Direct link to 2.5 自定义JPA操作接口">​</a></h3>
<p>这里的操作接口，对等的概念就是 MyBatis 的 mapper 接口，JPA 习惯保存于&quot;repository&quot;包。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 用户Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface UserRepository extends JpaRepository&lt;user,Integer&gt;{}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意事项
1.JpaRepository 接口是 Spring Data JPA 提供的接口,可帮助快速地对数据库进行增删改查操作，通常会成为自定义JPA接口的父接口;</p>
<p>2.JpaRepository 接口指定的第一个泛型表示实体类的类型，第二个泛型表示实体类主键的类型;</p>
<p>3.@Column 注解用于标识表的字段与实体属性的映射关系，name 属性用于标识表的字段名;</p>
<p>4.JpaRepository 接口的默认实现类 SimpleJpaRepository 中的 EntityManager 负责处理实体与数据库之间的交互。</p>
<h1>SpringDataJPA-反向建表</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1什么是反向建表">1.什么是反向建表<a href="#1什么是反向建表" class="hash-link" aria-label="Direct link to 1.什么是反向建表" title="Direct link to 1.什么是反向建表">​</a></h2>
<p>正向建表：在数据库中使用 SQL命令或工具菜单创建表，供Java程序访问与操作</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">--创建银行卡信息表(tbl_cardinfo)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> tbl cardinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    card_id </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;卡号&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    saving_id </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token string" style="color:#e3116c">&#x27;存款类型id&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cust_id </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token string" style="color:#e3116c">&#x27;用户id&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cur_value </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;RMB&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;币种&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_date </span><span class="token keyword" style="color:#00009f">datetime</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;开户日期&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    open_money </span><span class="token keyword" style="color:#00009f">decimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;开户金额&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    balance </span><span class="token keyword" style="color:#00009f">decimal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;当前余额&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pass </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;密码&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    is_reportloss </span><span class="token keyword" style="color:#00009f">bit</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">comment</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;是否挂失&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">primary</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">key</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">card_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>反向建表：在Java程序中创建与表映射的实体类，启动时自动在数据库中创建表格</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AllArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@NoArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class Card{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer cardId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer savingId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer custId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String curValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Date openDate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Double openMoney;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Double balance;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String pass;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Boolean isReportloss;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2反向建表相关注解">2.反向建表相关注解<a href="#2反向建表相关注解" class="hash-link" aria-label="Direct link to 2.反向建表相关注解" title="Direct link to 2.反向建表相关注解">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-entity">2.1 @Entity<a href="#21-entity" class="hash-link" aria-label="Direct link to 2.1 @Entity" title="Direct link to 2.1 @Entity">​</a></h3>
<p>作用：让 JPA 知晓这是一个和数据表映射的实体类常用属件:
name：实体类名，缺省则默认为实体类名单词的全小写形式。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-table">2.2 @Table<a href="#22-table" class="hash-link" aria-label="Direct link to 2.2 @Table" title="Direct link to 2.2 @Table">​</a></h3>
<p>作用：指定和哪个表映射
常用属性：
name：表名，缺省则表名默认为@Entity注解的name</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-column">2.3 @Column<a href="#23-column" class="hash-link" aria-label="Direct link to 2.3 @Column" title="Direct link to 2.3 @Column">​</a></h3>
<p>作用：指定实体属性和表字段的映射
常用属性:</p>
<ol>
<li>name：字段名 ，缺省则默认字段名为实体屈性名(全小写+下划线)</li>
<li>nullable：字段可允许null，默认true</li>
<li>unique：字段唯一标记，默认false</li>
<li>length：字段长度，当字段的类型为varchar时，该属性才有效，默认为255个字符</li>
<li>precision和scale：表示精度，当实体属性类型为BigDecimal时，precision表示总长度(默认38)，scale表示小数点的位数(默认2)，注意scale属性不支持实体属性类型Double与Float。</li>
<li>columnDefinition：字段定义，包含类型、长度、默认值和注释等等，类比建表的sq1中字段定义的部分</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-id">2.4 @Id<a href="#24-id" class="hash-link" aria-label="Direct link to 2.4 @Id" title="Direct link to 2.4 @Id">​</a></h3>
<p>作用：指定作为主键的实体属性</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-generatedvalue">2.5 @GeneratedValue<a href="#25-generatedvalue" class="hash-link" aria-label="Direct link to 2.5 @GeneratedValue" title="Direct link to 2.5 @GeneratedValue">​</a></h3>
<p>作用：指定作为自增列的实体属性</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3反向建表的启动配置">3.反向建表的启动配置<a href="#3反向建表的启动配置" class="hash-link" aria-label="Direct link to 3.反向建表的启动配置" title="Direct link to 3.反向建表的启动配置">​</a></h2>
<p>除了上述各注解配置好以外，反向建表还需要在application.yml文件中配置启动选型:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># JPA配管</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jpa</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hibernate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># create - 每次运行都会先删除表，然后新建(表数据每次清空)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># update - 每次运行都会先检查，无表会新建表，有表则更新表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># create-drop - 运行时采用create方式，结束运行后自动drop表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ddl-auto</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4查看sql语句">4.查看SQL语句<a href="#4查看sql语句" class="hash-link" aria-label="Direct link to 4.查看SQL语句" title="Direct link to 4.查看SQL语句">​</a></h2>
<p>可以在application.yml文件中配置 SpringDataJPA 执行操作时显示对应的SQL命令</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># JPA配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jpa</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 显示SQL命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        show</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5创建表索引">5.创建表索引<a href="#5创建表索引" class="hash-link" aria-label="Direct link to 5.创建表索引" title="Direct link to 5.创建表索引">​</a></h2>
<p>在前面 @Table 注解中，包含一项属性 indexes 用于创建表格索引</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Table(name =&quot;tbl_cardinfo&quot;,indexes={</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Index(name = &quot;custId index&quot;,columnList = &quot;custId,openDate desc&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意<!-- -->:name<!-- -->指定索引名字，columnList指定索引列，asc、desc指定排序规则。</p>
<h1>SpringDataJPA-动态更新</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1save方法">1.save方法<a href="#1save方法" class="hash-link" aria-label="Direct link to 1.save方法" title="Direct link to 1.save方法">​</a></h2>
<p>SpringDataJPA 中使用 save()方法实现数据的新增和更新，源码分析如下:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@NoRepositoryBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface CrudRepository&lt;T, ID&gt; extends Repository&lt;T, ID&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt;s save(S entity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... 其他方法&lt;略&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Repository继承情况</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CrudRepository 接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ListCrudRepository 接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		JpaRepository 接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			simpleJpaRepository实现类</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>SimpleJpaRepository 实现类中对 CrudRepository 父接口的 save()方法实现如下:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Transactiona1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@0verride</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public &lt;s extends T&gt;s save(s entity){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //实体的非空校验</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Assert.notNull(entity,&quot;Entity must not be null&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //如果查询实体是一个全新的实体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(entityInformation.isNew(entity)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 执行新增</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		entityManager.persist(entity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return entity;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //执行合并(更新)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return entityManager.merge(entity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>总结：默认情况，save()执行的是一种全量更新</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2局部更新">2.局部更新<a href="#2局部更新" class="hash-link" aria-label="Direct link to 2.局部更新" title="Direct link to 2.局部更新">​</a></h2>
<p>区别于save()的全量更新，局部更新指的是按自定义的 SQL语句去更新，在自定义SQL,命令中指定需要更新的字段。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21自定义更新方法">2.1自定义更新方法<a href="#21自定义更新方法" class="hash-link" aria-label="Direct link to 2.1自定义更新方法" title="Direct link to 2.1自定义更新方法">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 根据存款类型Id修改存款类型名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @param savingld 存款类型Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * mparam savingName 存款类型名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @return 受影响行数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int updateDeposit(Integer savingId,String savingName);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-query注解">2.2 @Query注解<a href="#22-query注解" class="hash-link" aria-label="Direct link to 2.2 @Query注解" title="Direct link to 2.2 @Query注解">​</a></h3>
<p>作用:自定义操作方法的SQL命令</p>
<p>语法:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Query(value =&quot;JPQL命令或者SQL命令&quot;,nativeQuery = true|false(*))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意事项：</p>
<ol>
<li>
<p>JPQL全称Java Persistence Query Language，中文详作&quot;Java持久化查询语言&quot;</p>
</li>
<li>
<p>nativeQuery设置true，代表使用原生SQL命令，否则使用JPQL命令，默认值false</p>
</li>
<li>
<p>如果执行 update 或 delete 命令，还需搭配 @Modifying 注解，否则出现&quot;Statement,executeQuery()cannot issue statements..&quot;</p>
</li>
<li>
<p>如果执行 update 或 delete 命令，还需搭配 @Transactional 注解，因为jpa要求没有事务支持，不能执行更新和制除操作</p>
</li>
</ol>
<p>问题:
借助自定义操作方法实现了局部更新，但被更新字段需要明确的指定，适合于确定的更新场景。如果被更新的字段无法明确指定，这种方式就不适合了。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3动态更新">3.动态更新<a href="#3动态更新" class="hash-link" aria-label="Direct link to 3.动态更新" title="Direct link to 3.动态更新">​</a></h2>
<p>所谓动态更新，就是可根据被更新的字段，动态的生成update指令，主要体现在 set 子句部分</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">--更新 savingName</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">update</span><span class="token plain"> tbl_deposit </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> saving_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">? </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> saving id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--更新 savingName 和 descrip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">update</span><span class="token plain"> tbl_deposit </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> saving_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">?</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> descrip</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">? </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> saving_id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-dynamicupdate">3.1 @DynamicUpdate<a href="#31-dynamicupdate" class="hash-link" aria-label="Direct link to 3.1 @DynamicUpdate" title="Direct link to 3.1 @DynamicUpdate">​</a></h3>
<p>作用:让 save()方法支持动态更新
类型:类级别的注解
实现原理:找出字段原值与本次更新的属性值的差异、将有差异的字段进行更新，没有差异的字段不做更新
问题:
某些允许Null的字段，在编码时因不想更新而忽略了set方法，实际结果是该字段原值被Null覆盖</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32完善动态更新">3.2完善动态更新<a href="#32完善动态更新" class="hash-link" aria-label="Direct link to 3.2完善动态更新" title="Direct link to 3.2完善动态更新">​</a></h3>
<p>首先，以数据库中找出待更新实体的原值</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Optional&lt;Deposit&gt; optional = depositRepository.findById(deposit.getsavingId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optional.ifPresentOrElse(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    optionalDeposit-&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //后续的修改操作。。。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	()&gt;system.out.println(&quot;未查找!&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接着，找出待更新的实体对象中，哪些屈性忽略了set方法的设置</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Beanwrapper wrapper =new BeanwrapperImpl(deposit);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String[] isNullProperties = Stream.of(wrapper.getPropertyDescriptors())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .map(PropertyDescriptor::getName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .filter(propertyName&gt;wrapper.getPropertyValue(propertyName)== nu1l)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .toArray(String[]::new);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后，把待更新的实体对象中非Null的属性值复制给数据库中找到的实体</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">BeanUtils.copyProperties(deposit,optionalDeposit,isNullProperties);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最后，使用 save()方法实现更新，参数注意使用数据库中找到的实体</p>
<h1>SpringDataJPA-删除表数据</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1常规删除操作">1.常规删除操作<a href="#1常规删除操作" class="hash-link" aria-label="Direct link to 1.常规删除操作" title="Direct link to 1.常规删除操作">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-按id删除">1.1 按ID删除<a href="#11-按id删除" class="hash-link" aria-label="Direct link to 1.1 按ID删除" title="Direct link to 1.1 按ID删除">​</a></h3>
<p>按对象Id删除，直角调用 deleteByld()方法进行删除，是使用最为频繁的删除方式</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Integer id = 9;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteById(id);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-按对象删除">1.2 按对象删除<a href="#12-按对象删除" class="hash-link" aria-label="Direct link to 1.2 按对象删除" title="Direct link to 1.2 按对象删除">​</a></h3>
<p>按对象删除，通常会根据Id 事先查询出待删除对象，然后调用 delete()方法进行删除</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Integer id = 9;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Optional&lt;Deposit&gt; optional = depositRepository.findById(id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optional.ifPresentorElse(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	deposit-&gt; depositRepository.delete(deposit),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ()-&gt; System.out.println(&quot;未找到!&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13全表删除">1.3全表删除<a href="#13全表删除" class="hash-link" aria-label="Direct link to 1.3全表删除" title="Direct link to 1.3全表删除">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">deleteAll()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deleteAlInBatch()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>deleteAll()首先通过 findAll()查找所有需要删除的实体对象，然后逐条删除并提交事务，这意味着它会执行多条SQL语句米完成删除操作。这种方式虽然简单，但效率相对较低，因为它涉及到多次数据库交互和事务提交。</p>
<p>deleteAllInBatch()则只执行一条S0L语句来制除所有实体对象，这意味着它通过一条命令完成所有实体的删除，从而大大减少了数据库交互的次数，提高了制除操作的效率。这种方式更适合于需要大量删除操作的情况，因为它能够显普减少数据库负载和提高性能。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2批量删除操作">2.批量删除操作<a href="#2批量删除操作" class="hash-link" aria-label="Direct link to 2.批量删除操作" title="Direct link to 2.批量删除操作">​</a></h2>
<p>批量删除语句不同的删除条件，又分成:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21按id批量删除">2.1按ID批量删除<a href="#21按id批量删除" class="hash-link" aria-label="Direct link to 2.1按ID批量删除" title="Direct link to 2.1按ID批量删除">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Iterable&lt;Integer&gt; ids = Arrays.asList(1,2,3,4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteAllById(ids);// where id =?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteAllByIdInBatch(ids); // where id in (?,?,?,?)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-按对象集合批量删除">2.2 按对象集合批量删除<a href="#22-按对象集合批量删除" class="hash-link" aria-label="Direct link to 2.2 按对象集合批量删除" title="Direct link to 2.2 按对象集合批量删除">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Iterable&lt;Integer&gt; ids =Arrays.asList(1,2,3,4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;Deposit&gt; depositList = depositRepository.findAllById(ids);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteAll(depositList);//where id = ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteAllInBatch(depositList);// where id =? or id = ?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3自定义删除操作">3.自定义删除操作<a href="#3自定义删除操作" class="hash-link" aria-label="Direct link to 3.自定义删除操作" title="Direct link to 3.自定义删除操作">​</a></h2>
<p>当前面所讲解的删除接口无法满足实际开发需求时，可以自定义删除</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31自定义删除方法">3.1自定义删除方法<a href="#31自定义删除方法" class="hash-link" aria-label="Direct link to 3.1自定义删除方法" title="Direct link to 3.1自定义删除方法">​</a></h3>
<p>这里谈到的自定义删除SQL，需要使用 @Transactional+ @Modifying+ @Query 三个注解搭配完成</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 存款类型的Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Transactional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface DepositRepository extends JpaRepository&lt;Deposit, Integer&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Modifying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @0uery(value= &quot;delete from tbl_deposit where saving_name like %:like%&quot;, native0uery =true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	int deleteByCustermize(String like);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-声明式删除方法">3.2 声明式删除方法<a href="#32-声明式删除方法" class="hash-link" aria-label="Direct link to 3.2 声明式删除方法" title="Direct link to 3.2 声明式删除方法">​</a></h3>
<p>SpringDataJPA提供了一种声明式的删除方法，允许开发者通过方法名来定义删除逻辑。方法底层的SQL语句由Spring Data JPA 自动生成，要求方法名需要以delete或remove开头。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1.deleteByXxx:删除Xxx属性等于某个指定值的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2.deleteByXxxNot:删除Xxx属性不等于某个指定值的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3.deleteByXxxLessThan(Equal):删除Xxx属性值小于(等于)某个指定值的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4.deleteByXxxGreaterThan(Equal):删除Xxx属性值大于(等于)某个指定值的数据，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5.dleleteByXxxBetween:根据Xxx属性值的范围删除数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6.deleteByXxxLike:删除Xxx属性值模糊匹配某个指定值(%值%)的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7.deleteByxxxNotLike:册除Xxx属性值模糊匹配某个指定值以外的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8.deleteByXxxIsNu11:册除Xxx属性值为Null的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9.deleteByXxxIsNOtNu11:删除Xxx属性值不为Null的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.deleteByXxxIn:删除Xxx属性值在某个集合中的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">11.deleteByXxxNotIn:删除Xxx属性值不在某个集合中的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12.deleteByXxxAndYyy:根据Xxx属性值和Yyy属性值删除数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13.deleteByxxx0rYyy:根据Xxx属性值或Yyy属性值删除数据</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意:上述所有自定义的 删除方法，均需要与 @Transactional+ @Modifying 两个注解搭配使用</p>
<h1>SpringDataJPA-逻辑删除</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1逻辑删除">1.逻辑删除<a href="#1逻辑删除" class="hash-link" aria-label="Direct link to 1.逻辑删除" title="Direct link to 1.逻辑删除">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11表结构的更改">1.1表结构的更改<a href="#11表结构的更改" class="hash-link" aria-label="Direct link to 1.1表结构的更改" title="Direct link to 1.1表结构的更改">​</a></h3>
<p>前面的讲解中，所使用的数据表结构</p>
<table><thead><tr><th>字段名</th><th>说明</th><th>备注</th></tr></thead><tbody><tr><td>saving_id</td><td>存款类型id</td><td>自增、主键</td></tr><tr><td>saving_name</td><td>存款类型名字</td><td>非空</td></tr><tr><td>descerip</td><td>存款类型描述</td><td>允许空</td></tr></tbody></table>
<p>本集对表结构进行更改，添加逻辑删除的标记字段&quot;is_deleted&quot;</p>
<table><thead><tr><th>字段名</th><th>说明</th><th>备注</th></tr></thead><tbody><tr><td>saving_id</td><td>存款类型id</td><td>自增、主键</td></tr><tr><td>saving_name</td><td>存款类型名字</td><td>非空</td></tr><tr><td>descerip</td><td>存款类型描述</td><td>允许空</td></tr><tr><td>is_deleted</td><td>是否已删除</td><td>0-未删除，默认；1-已删除</td></tr></tbody></table>
<p>相应地，程序中的实体类也要添加属性&quot;isDeleted&quot;</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@AllArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@NoArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Entity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Table(name =&quot;tbl_deposit&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Deposit{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Generatedvalue(strategy = GenerationType.IDENTITY)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer savingId;//存款类型id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string savingName;//存款类型名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string descrip;//存款类型描述</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Boolean isDeleted;//逻辑删除标记(默认false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-sqldelete">1.2 @SQLDelete<a href="#12-sqldelete" class="hash-link" aria-label="Direct link to 1.2 @SQLDelete" title="Direct link to 1.2 @SQLDelete">​</a></h3>
<p>作用：将 SpringDataJPA 自动生成的删除语句替换为自定义的语句</p>
<p>类型：TYPE,FIELD,METHOD</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@SQLDelete(sql =&quot;update tbl deposit set is deleted=1 where saving_id=?&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Deposit{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GeneratedValue(strategy= GenerationType .IDENTITY)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer savingId;//存款类型id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string savingName;//存款类型名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string descrip;//存款类型描述</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Boolean isDeleted://逻辑删除标记(默认false) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-测试逻辑删除">1.3 测试逻辑删除<a href="#13-测试逻辑删除" class="hash-link" aria-label="Direct link to 1.3 测试逻辑删除" title="Direct link to 1.3 测试逻辑删除">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//CrudRdpository-&gt; deleteById(id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteById(1):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//crudRepository-&gt; delete(entity)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.delete(depositRepository.findById(1).get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// CrudRepository-&gt; deleteAl1()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteAll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//CrudRepository-&gt; deleteAllById(ids)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteAllById(Arrays.asList(1,2,3,4));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//CrudRepository&gt; deleteAll(entities)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteAll(depositRepository.findAll());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//声明式删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteBySavingNameAndDescrip(&quot;存本取息五年&quot;,&quot;按月支取利息&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2物理删除">2.物理删除<a href="#2物理删除" class="hash-link" aria-label="Direct link to 2.物理删除" title="Direct link to 2.物理删除">​</a></h2>
<p>如果是开发者自定义SQL删除，还是会执行物理删除，这时候会将数据真正从数据表中清理掉。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-自定义sql删除">2.1 自定义SQL删除<a href="#21-自定义sql删除" class="hash-link" aria-label="Direct link to 2.1 自定义SQL删除" title="Direct link to 2.1 自定义SQL删除">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Modifying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Query(value = &quot;delete from tbl_deposit where saving_id=%:savingId%&quot;, nativeQuery =true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int deleteBysavingId(Integer savingId);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对于批量删除操作(InBatch方法)，是为了高效地处理大量数据的物理删除，而不是逻辑删除。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-inbatch删除">2.2 InBatch删除<a href="#22-inbatch删除" class="hash-link" aria-label="Direct link to 2.2 InBatch删除" title="Direct link to 2.2 InBatch删除">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteAllInBatch();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteAllByIdInBatch(Arrays.asList(1,2,3 4));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteAllInBatch(depositRepository.findAll());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3逻辑删除的影响">3.逻辑删除的影响<a href="#3逻辑删除的影响" class="hash-link" aria-label="Direct link to 3.逻辑删除的影响" title="Direct link to 3.逻辑删除的影响">​</a></h2>
<p>这里所讲的删除删除影响，指的是逻辑删除对查询操作、修改操作、甚至对于删除操作本身都会有影响。这些影响集中体现在被逻辑删除的记录不应再被查询、被修改和被删除了。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31对查询的影响">3.1对查询的影响<a href="#31对查询的影响" class="hash-link" aria-label="Direct link to 3.1对查询的影响" title="Direct link to 3.1对查询的影响">​</a></h3>
<p>被逻辑删除的记录，使用查询操作时不应该查询出来，对应的查询命令要添加&quot;限制条件&quot;</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">--查询全表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tbl_deposit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--查询全表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tbl_deposit </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> is_deleted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过 @SQLRestriction 注解可在 SpringDataJPA 自动生成的查询语句上添加&quot;限制条件&quot;</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@SQLRestriction(&quot;is_deleted = 0&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Deposit{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GeneratedValue(strategy = GenerationType.IDENTITY)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer savingId;//存款类型id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String savingName;//存款类型名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private string descrip;//存款类型描述</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Boolean isDeleted;//逻辑删除标记(默认false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-对修改的影响">3.2 对修改的影响<a href="#32-对修改的影响" class="hash-link" aria-label="Direct link to 3.2 对修改的影响" title="Direct link to 3.2 对修改的影响">​</a></h3>
<p>记录行逻辑删除之前可正常修改;一旦某些记录被逻辑删除了，理论上来说是不可再修改了;</p>
<p>但实际上 SpringDataJPA 并不会阻止对已逻辑删除的记录再次修改(例如:撤销删除)，只是结果会变成新增记录。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//逻辑删除 id =9 的记录行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.deleteById(9);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//对 id= 9 的记录撤销删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deposit deposit = new Deposit(9,&quot;存本取息五年&quot;,&quot;按月支取利息&quot;,false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.save(deposit);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果需要撤销删除，可以使用自定义SQL去实现</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Modifying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Query(value = &quot;update tbl_deposit set is_deleted=0 where saving_id=:savingId&quot;,nativeQuery =true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int cancelDeletedById(Integer savingId);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-preremove">3.3 @PreRemove<a href="#33-preremove" class="hash-link" aria-label="Direct link to 3.3 @PreRemove" title="Direct link to 3.3 @PreRemove">​</a></h3>
<p>当一个实体被删除之前，会调用被 @PreRemove 注解标记的方法</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Deposit{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GeneratedValue(strategy= GenerationType.IDENTITY)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer savingId;//存款类型id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String savingName;//存款类型名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String descrip;//存款类型描述</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Boolean isDeleted;//逻辑删除标记(默认false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PreRemove</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void deleteDeposit(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.isDeleted = true;//逻辑删除字段状态的变更(false变true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>由于 @SQLDelete 注解的原理是对默认的 delete 命令进行替换，因此 SpringDataJPA并不知道操作实体的相应字段发生了改变，除非 flush 到数据库中，否则这样的&quot;不知情&quot;状态会一直保持在当前会话之中。为避免带来负面影响，可通过上面的 @PreRemove 注解，提前更新实体的字段状态。</p>
<h1>SpringDataJPA-查询表数据</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1查询方式分类">1.查询方式分类<a href="#1查询方式分类" class="hash-link" aria-label="Direct link to 1.查询方式分类" title="Direct link to 1.查询方式分类">​</a></h2>
<p>SpringDataJPA 提供了四种查询的方式，分别是</p>
<ol>
<li>继承 JpaRepository 接囗</li>
<li>使用 JPQL 实现查询</li>
<li>使用原生 SQL 实现查询</li>
<li>使用&quot;声明式&quot;方法实现查询</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2继承jparepository-接口">2.继承JpaRepository 接口<a href="#2继承jparepository-接口" class="hash-link" aria-label="Direct link to 2.继承JpaRepository 接口" title="Direct link to 2.继承JpaRepository 接口">​</a></h2>
<p>只需要开发自定义的数据访问层接口，实现对JpaRepository 接口的继承。这种方式也是使用频率最高的</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 用户信息的Repository&lt;实体类型，实体类主键类型&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface UserRepository extends JpaRepository&lt;User, Integer&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 根据实体类的ID获取实体的引用，而不是立即加载实体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 方法返回一个实体的代理对象,当实际访问实体属性时，代理对象才真正加载实体(懒加载机制)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">T getReferenceById(ID id):</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>SpringDataJPA 的&quot;懒加载机制&quot;需要事务的支持，以确保数据的一致性和完整性:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Transactional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void testJpaRepository(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	User user = userRepository.getReferenceById(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(&quot;user =&quot;+ user);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># JPA配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jpa</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">properties</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">hibernate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">#允许没有事务的懒加载，不要在生产环境中使用!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                enable_lazy_load_no_trans</span><span class="token punctuation" style="color:#393A34">:</span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>JpaRepository 接口本身继承了三个父接口，分别是:</p>
<ol>
<li>ListCrudRepository接口：在CrudRepository接口基础上扩展了一些特定于列表的方法。</li>
<li>ListPagingAndsortingRepository接口：一个用于支持分页和排序功能的接口。</li>
<li>QueryByExampleExecutor接口：简称QBE接口，根据查询条件(Example对象)来执行复杂的查询操作。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-listcrudrepository接口">2.1 ListCrudRepository接口<a href="#21-listcrudrepository接口" class="hash-link" aria-label="Direct link to 2.1 ListCrudRepository接口" title="Direct link to 2.1 ListCrudRepository接口">​</a></h3>
<p>ListCrudRepository的父接口是 CrudRepository，在 CrudRepository父接口中查询相关的方法包括</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//查询全部实体集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Iterable&lt;T&gt; findAll()-&gt; List&lt;T&gt; findAll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//根据ids查询实体集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Iterable&lt;T&gt; findAllById(Iterable&lt;ID&gt; ids)-&gt; List&lt;T&gt; findAllById(Iterable&lt;ID&gt; ids)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//根据id查询单个实体(定义在父接口crudRepository中)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0ptional&lt;T&gt; findById(ID id):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//根据id查询单个实体是否存在(定义在父接口crudRepository中)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boolean existsById(ID id);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-listpagingandsortingrepository接口">2.2 ListPagingAndSortingRepository接口<a href="#22-listpagingandsortingrepository接口" class="hash-link" aria-label="Direct link to 2.2 ListPagingAndSortingRepository接口" title="Direct link to 2.2 ListPagingAndSortingRepository接口">​</a></h3>
<p>ListPagingAndSortingRepository 的父接口是 PagingAndSortingRepository，在父接口中查询相关的方法包括</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//排序查询全部实体集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Iterable&lt;T&gt; findAll(Sort sort);-&gt; List&lt;T&gt; findAll(Sort sort);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 分页查询(本集暂不讨论)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Page&lt;T&gt; findAll(Pageable pageable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//按照实体属性cusId(不是表字段)降序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sort sort1 = Sort.by(sort.Direction.DESC,&quot;cusId&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//按照实体属性cusName(不是表字段)升序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sort sort2 = Sort.by(sort.Direction.ASC,&quot;cusName&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//按照sort1(主)、sort2(从)联合排序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sort sort=sort1.and(sort2);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-querybyexampleexecutor接囗">2.3 QueryByExampleExecutor接囗<a href="#23-querybyexampleexecutor接囗" class="hash-link" aria-label="Direct link to 2.3 QueryByExampleExecutor接囗" title="Direct link to 2.3 QueryByExampleExecutor接囗">​</a></h3>
<p>QueryByExampleExecutor接口用于按特定的示例条件实现数据查询。
这个接口的方法与&quot;动态查询&quot;的主题关联，将会在后面的视频中去讲解实现，本集不讨论。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface QueryByExampleExecutor&lt;T&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //根据示例查询条件，查找单个对象(返回多个对象引发异常)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; optional&lt;S&gt; findOne(Example&lt;S&gt; example);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //根据示例查询条件，查找多个对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; Iterable&lt;S&gt; findAll(Example&lt;S&gt; example);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //根据示例查询条件，查找多个对象并排序显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; Iterable&lt;S&gt; findAll(Example&lt;S&gt; example, Sort sort);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //根据示例查询条件，查找多个对象并分页显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; Page&lt;s&gt; findAll(Example&lt;s&gt;example, Pageable pageable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //根据示例查询条件，查找符合条件的对象个数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; long count(Example&lt;S&gt; example);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //根据示例查询条件，查找对象是否存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; boolean exists(Example&lt;S&gt; example);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //根据自定义查询函数执行复杂查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T,R&gt;R findBy(Example&lt;s&gt; example...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3使用jpql实现查询">3.使用JPQL实现查询<a href="#3使用jpql实现查询" class="hash-link" aria-label="Direct link to 3.使用JPQL实现查询" title="Direct link to 3.使用JPQL实现查询">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31什么是jpql">3.1什么是JPQL<a href="#31什么是jpql" class="hash-link" aria-label="Direct link to 3.1什么是JPQL" title="Direct link to 3.1什么是JPQL">​</a></h3>
<p>定义：JPQL的全称是&quot;Java Persistence Query Language&quot;，中文译作&quot;]ava持久化查沟语言&quot;。这是一种以面向对象的方式操作数据库的语言。
原理：JPQL的特征与原生SQL语句类似，但完全面向对象，通过类名和属性访问，而不是使用表名和表的字段。这种语言最终会被编译成针对不同底层数据库的SQL查询，从而屏蔽了不同数据库之间的差异。
注意：JPQL 不支持使用INSERT，对于 UPDATE、DELETE操作，必须使用注解@Modifying。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32定义jpql查询方法">3.2定义JPQL查询方法<a href="#32定义jpql查询方法" class="hash-link" aria-label="Direct link to 3.2定义JPQL查询方法" title="Direct link to 3.2定义JPQL查询方法">​</a></h3>
<p>查询&quot;湖南&quot;的用户列表</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Query(value = &quot;from User where cusAdd like %:address%&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; getUserListByAddress(String address);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意事项:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from 实体名。实体类的名字参照 @Entity(name=“实体名”)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">where 属性名。属性名参照实体类中的属性命名</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4使用原生-sql实现查询">4.使用原生 SQL实现查询<a href="#4使用原生-sql实现查询" class="hash-link" aria-label="Direct link to 4.使用原生 SQL实现查询" title="Direct link to 4.使用原生 SQL实现查询">​</a></h2>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Query(value = &quot;select * from tbl_userinfo where cus_add like %:address%&quot;,nativeQuery =true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; getUserListByAddress(string address);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意事项:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">value中的  语句采用原生sq1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">设置 nativeouery = true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5使用声明式方法实现查询">5.使用&quot;声明式&quot;方法实现查询<a href="#5使用声明式方法实现查询" class="hash-link" aria-label="Direct link to 5.使用&quot;声明式&quot;方法实现查询" title="Direct link to 5.使用&quot;声明式&quot;方法实现查询">​</a></h2>
<p>声明式杏询方法，仅需方法名字按指定规范，方法所采用的SQL命令会自动构建
查询方法以find或者get开头，其余规则如下:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">findByXxx:查询Xxx屈性等于某个指定值的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxxNot:査询Xxx属性不等于某个指定值的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxxLessThan(Equal):查询Xxx属性值小于(等于)某个指定值的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByxxxGreaterThan(Equal):查询Xxx属性值大于(等于)某个指定值的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxxBetween:根据Xxx屆性值的范围查询数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxxLike:查询xxx届性值模湖匹配某个指定值(%值%)的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxxNotLike:查询Xxx屆性值模糊匹配某个指定值以外的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxXISNull:香询xxx届性值为Null的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxxIsNotNull:查询Xxx属性值不为Null的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxxIn:查询xxx屈性值在某个集合中的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxxNotn:查询Xxx属性值不在某个集合中的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxxAndYyy:根据Xxx屆性值和Yyy居性值查询数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">findByXxx0rYyy:根据Xxx属性值或Yyy属性值查询 数据</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>SpringDataJPA-动态查询</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1动态查询的含义">1.动态查询的含义<a href="#1动态查询的含义" class="hash-link" aria-label="Direct link to 1.动态查询的含义" title="Direct link to 1.动态查询的含义">​</a></h2>
<p>在进行数据库查询时，我们通常会遇到两种类型的查询：静态查询和动态查询。静态查询是指在编译时确定的查询，而动态查询则是在运行时构建的查询。例如:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">--根据部门查询员工列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> emp </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> deptNo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--根据部门、年酸查询员工列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> emp </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> deptNo</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ? </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> empAge </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--根据部门、年龄和入职日期查询员工列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> emp </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> deptNo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ? </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> empAge </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ? </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> empJoinData </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2querybyexampleexecutor接口">2.QueryByExampleExecutor接口<a href="#2querybyexampleexecutor接口" class="hash-link" aria-label="Direct link to 2.QueryByExampleExecutor接口" title="Direct link to 2.QueryByExampleExecutor接口">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21接口概述">2.1接口概述<a href="#21接口概述" class="hash-link" aria-label="Direct link to 2.1接口概述" title="Direct link to 2.1接口概述">​</a></h3>
<p>QueryByExampleExecutor 接口用于按特定的&quot;示例条件&quot;实现数据的查询，通常也简称为&quot;QBE&quot;查询。
接口中声明了7个方法，如下:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface QueryByExampleExecutor&lt;T&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 查找单个对象(返回多个对象引发异常)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;s extends T&gt; optional&lt;S&gt; findone(Example&lt;S&gt; example);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 查找多个对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; Iterable&lt;S&gt; findAll(Example&lt;S&gt; example);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 查找多个对象并排序显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; Iterable&lt;S&gt; findAll(Example&lt;S&gt; example, Sort sort);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 查找多个对象并分页显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; Page&lt;S&gt; findAll(Example&lt;S&gt; example, Pageable pageable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //统计符合条件的对象个数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; long count(xample&lt;S&gt; example);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //查找符合条件的对象是否存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T&gt; boolean exists(Example&lt;S&gt; example);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //根据自定义查询函数执行查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T,R&gt; R findBy(Example&lt;S&gt; example,Function&lt;FluentQuery.FetchableFluentQuery&lt;S&gt;，R&gt;queryFunction);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>&quot;QBE&quot;查询的三要素</p>
<ol>
<li>封装查询条件的实体：当前被查询的数据表映射的实体对象，根据属性值是否NuLL决定查询的字段</li>
<li>ExampleMatcher：查询示例的匹配器，提供的匹配API包括matching()、matchingAny()等等</li>
<li>封装1和2的Example对象：通过Example.of(Bean,ExampleMatcher)构建Example对象</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22基本使用">2.2基本使用<a href="#22基本使用" class="hash-link" aria-label="Direct link to 2.2基本使用" title="Direct link to 2.2基本使用">​</a></h3>
<p>1.精确查询</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//1.构建(封装了查询条件的)实体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User searchUser =new User();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchUser.setCusId(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//2.构建Example对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;user&gt; example = Example.of(searchuser,ExampleMatcher .matching());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//3.执行查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; userList = userRepository.findAll(example);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2.区分大小写的查询默认情况下，MySql是不区分大小写的，如果需要指定某个表区分大小写，如下:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> tbl_userinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token comment" style="color:#999988;font-style:italic">--字段定义&lt;略&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token keyword" style="color:#00009f">collate</span><span class="token plain"> utf8mb4_bin</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">--区分大小写的字符集 utf8mb4_bin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>实现所有属性都不区分大小写的查询</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;User&gt; example = Example.of(searchUser,ExampleMatcher.matching().withIgnoreCase());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>实现指定属性不区分大小写的查询</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ExamplecUser&gt; example = Example.of(searchUser.ExampleMatcher.matching().withIgnoreCase(&quot;cusName&quot;));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3.模糊查询</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 包含指定字符串的模糊査询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;User&gt; example = Example.of(searchUser,ExampleMatcher.matching().withStringMatcher(ExampleMatcher.stringMatcher.CONTAINING));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//指定字符中开头的模糊查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;User&gt; example= Example.of(searchUser,ExampleMatcher .matching().withStringMatcher(ExampleMatcher.StringMatcher.STARTING));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//指定宁符串结尾的模糊查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;User&gt;example= Example,of(searchUser, ExampleMatcher.matching().withstringMatcher(ExampleMatcher.stringMatcher.ENBING));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意:不指定 withStringMatcher()时默认精确匹配</p>
<p>4.Null 值属性作为查询条件
在 searchUser 对象中值为 Null 的属性，可控制(不)出现在查询的条件中。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//忽略NULL值的居性(默认)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;User&gt; example = Example.of(searchUser,ExampleMatcher.matching().withIgnoreNullvalues());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//NULL值居性作为查询条件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;User&gt; example = Example.of(searchUser, ExampleMatcher .matching().withIncludeNullvalues());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>5.忽略指定的屈性不作为查询条件</p>
<p>在 searchUser 对象中的属性，可排除在查询的条件外。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//忽路cusName属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;User&gt; example= Example.of(searchUser,ExampleMatcher .matching().withIgnorePaths(&quot;cusName&quot;));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>6.Null值查询</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//1.构建(封装了查询条件的)实体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User searchUser=new User();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchUser.setCusAdd(null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//2.构建Example对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;User&gt;example = xample.of(searchUser, ExampleMatcher.matching().withIncludeNullValues().withIgnorePaths(JPAUtils.isNullProperties(searchUser,&quot;cusAdd&quot; )));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//注:JPAUtils.isNullProperties(searchUser,&quot;cusAdd&quot;)用于忽略其他null的属性查询条件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23动态查询">2.3动态查询<a href="#23动态查询" class="hash-link" aria-label="Direct link to 2.3动态查询" title="Direct link to 2.3动态查询">​</a></h3>
<p>动态查询的条件，在 QueryByExarmpleExecutor 接口中可通过如下两种方式连接起来</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">or -&gt; ExampleMatcher.matchingAny()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">and -&gt; ExampleMatcher.matching()、ExampleMatcher.matchingAll()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//1.构建(封装了查询条件的)实体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User searchUser=new User();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchUser.setCusName(&quot;andy&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchUser.setCusAdd(&quot;湖南长沙&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//2.构建Example对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;user&gt; example = Example.of(searchuser,ExampleMatcher.matching());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//3.执行查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; userList = userRepository.findAll(example);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>动态查询的条件，还可分别指定匹配的方式，然后再使用 or、and 连接起来</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//1.构建(封装了查询条件的)实体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User searchUuser=new User();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchUser.setCusId(1):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchUser.setCusName(&quot;andy&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchUser.setcusAdd(&quot;湖南&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//2.构建Example对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;User&gt; example = Example.of(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    searchUser,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExampleMatcher.matching()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .withMatcher(&quot;cusId&quot;,matcher -&gt; matcher.exact())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .withMatcher(&quot;cusName&quot;,matcher -&gt; matcher.exact())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .withMatcher(&quot;cusAdd&quot;,matcher -&gt; matcher.contains())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//3.执行查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; userList = userRepository.findAll(example):</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24接口小结">2.4接口小结<a href="#24接口小结" class="hash-link" aria-label="Direct link to 2.4接口小结" title="Direct link to 2.4接口小结">​</a></h3>
<p>&quot;QBE&quot;查询的优点:</p>
<ol>
<li>适合字符串类型的查询匹配(精确匹配、模糊匹配)</li>
<li>简单易用，学习成本低。通过修改实体的屈性即轻松实现&quot;动态查询&quot;</li>
<li>不需要写复杂的SQL或者JPQL查询，减少了对查询语言的依赖</li>
</ol>
<p>&quot;QBE&quot;查询的不足:</p>
<ol>
<li>不适合数字类型的大小比较<code>(&gt;、&lt;、&gt;=、&lt;=)</code></li>
<li>不适合 <code>between...and、in、is null</code> 等形式的查询</li>
<li>常用来处理简单的查询，不支持复杂的连接查询、嵌套查询、分组查询等</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3jpaspecifcationexecutor接口">3.JpaSpecifcationExecutor接口<a href="#3jpaspecifcationexecutor接口" class="hash-link" aria-label="Direct link to 3.JpaSpecifcationExecutor接口" title="Direct link to 3.JpaSpecifcationExecutor接口">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31接口概述">3.1接口概述<a href="#31接口概述" class="hash-link" aria-label="Direct link to 3.1接口概述" title="Direct link to 3.1接口概述">​</a></h3>
<p>JpaSpecificationExecutor是 Spring DataJPA 提供的一个接口，它允许执行复杂的查询逻辑，特别是基于Specification 的动态查询。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface JpaspecificationExecutor&lt;T&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 查找单个对象(返回多个对象引发异常)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0ptional&lt;T&gt; findone(specificationsT&gt; spec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 查找多个对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;T&gt; findAll(specification&lt;T&gt; spec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 查找多个对象并排序显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;T&gt; findAll(Specification&lt;T&gt; spec, Sort sort);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 在找多个对象并分贞显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Page&lt;T&gt; findAll(Specification&lt;T&gt; spec, Pageable pageable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 统计符合条件的对象个数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long count(Specification&lt;T&gt; spec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 查找符合条件的对象是否存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    boolean exists(Specification&lt;T&gt; spec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 根据自定义查询函数执行查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;S extends T,R&gt; R findBy(Specification&lt;T&gt; spec,Function&lt;FluentQuery.FetchableFluentQuery&lt;S&gt;,R&gt;queryFunction);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 删除符合条件的对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long delete(Specification&lt;T&gt; spec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Specification 接口未提供默认实现的方法 toPredicate(root,query,criteriaBuilder)，源码如下:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//root:查询的根对象(root可访问实体的属性)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//CriteriaQuery:顶层查询对象，自定义查询方式(了查询)//criteriaBuilder:查询的构造器，封装了很多的查询的操作(equa1、like、lt、gt、….)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Predicate toPredicate(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuildercriteriaBuilder);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>toPredicate()方法中的第2、第3个参数的类型都与&quot;Criteria(标准)&quot;有关，这种基于&quot;Criteria&quot;去构建条件的查询，通常也简称为&quot;QBC(QueryByCriteria)&quot;查询。
自定义的数据访问接口继承JpaSpecificationExecutor  接口示例:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 用户的Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface UserRepository extends JpaRepository&lt;User,Integer&gt;,JpaSpecificationExecutor&lt;User&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//注意:必须继承父接口 JpaRepository，否则无法注入 UserRepository 的 Bean 对象</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32基本使用">3.2基本使用<a href="#32基本使用" class="hash-link" aria-label="Direct link to 3.2基本使用" title="Direct link to 3.2基本使用">​</a></h3>
<p>先从最基本的查询开始:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 1.构建 specification(匿名内部类)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Specification&lt;User&gt; specification = new Specification&lt;User&gt;(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Predicate toPredicate(Root&lt;User&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return cb.equal(root.get(&quot;cusId&quot;),1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//2.执行查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; userList = userRepository.findAll(specification);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>更多的查询示例:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// cusAdd like&#x27;%湖南%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.like(root.get(&quot;cusAdd&quot;)，&quot;%湖南%&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// cusId !=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.not(cb.equal(root.get(&quot;cusId&quot;),1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.equal(root.get(&quot;cusId&quot;),1).not();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// cusId &lt; 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.lessThan(root.get(&quot;cusId&quot;),3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.lt(root.get(&quot;cusId&quot;),3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// cusId &gt;1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.greaterThan(root.get(&quot;cusId&quot;),1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.gt(root.get(&quot;cusId&quot;),1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//cusId &lt;= 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.lessThanOrEqualTo(root.get(&quot;cusId&quot;),3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.le(root.get(&quot;cusId&quot;),3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//cusId &gt;= 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.greaterThanOrEqualTo(root.get(&quot;cusId&quot;),3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.ge(root.get(&quot;cusId&quot;),3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//cusId &gt;= 1 and cusId &lt;= 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.between(root.get(&quot;cusId&quot;),1,3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//cusId in(1,2,3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.in(root.get(&quot;cusId&quot;)).value(Arrays.asList(1,2,3));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//cusAdd == nul1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.isNull(root.get(&quot;cusAdd&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// cusAdd != nul1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.isNotNull(root.get(&quot;cusAdd&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//isDeleted == false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.isFalse(root.get(&quot;isDeleted&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// isDeleted == true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cb.isTrue(root.get(&quot;isDeleted&quot;));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33动态查询">3.3动态查询<a href="#33动态查询" class="hash-link" aria-label="Direct link to 3.3动态查询" title="Direct link to 3.3动态查询">​</a></h3>
<p>动态查询的条件，在JpaSpecificationExecutor接口中可通过如下式连接起来</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//1.构建(封装了查询条件的)实体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User userParam =new User();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userParam.setCusId(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userParam.setCusName(&quot;andy&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userParam.setCusAdd(&quot;湖南&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//2.执行查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;user&gt; userList = userRepository.findAll((root,query,cb)-&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //动态查询的多个条件集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    List&lt;Predicate&gt; predicateList = new ArrayList&lt;Predicate&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(userParam.getCusId()!= null){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //cusId 精匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		predicateList.add(cb,equal(root.get(&quot;cusId&quot;),userParam.getCusId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if(userParam.getCusName()!=null){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //cusName 精确匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		predicateList.add(cb,equal(root .get(&quot;cusName&quot;),userParam.getCusName()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	if(userParam.getCusAdd()!= null){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //cusAdd 模糊匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        predicateList.add(cb.like(root.get(&quot;cusAdd&quot;),&quot;%&quot;+ userParam.getcusAdd()+&quot;%&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return cb.and(predicateList.toArray(new Predicate[0]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34接口小结">3.4接口小结<a href="#34接口小结" class="hash-link" aria-label="Direct link to 3.4接口小结" title="Direct link to 3.4接口小结">​</a></h3>
<p>&quot;QBC&quot;查询的优点：适用范围广，几乎可以实现所有查询的场景
&quot;QBC&quot;查询的不足：每个查询都需要手动构建Specification，提高了复杂度、增加了代码量</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4querydsl">4.QueryDSL<a href="#4querydsl" class="hash-link" aria-label="Direct link to 4.QueryDSL" title="Direct link to 4.QueryDSL">​</a></h2>
<p>4.1框架概述
QueryDSL是一个通用查询框架。通过JavaAPI构建类型安全的SQL查询。QueryDSL 代码可读性非常强并与JPA 高度集成。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;</span><span class="token tag" style="color:#00009f">!--querydsl-jpa</span><span class="token plain"> 依赖</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.querydsl&lt;/groupId</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">querydsl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ipa&lt;/artifactId</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;</span><span class="token tag" style="color:#00009f">!--JDK17</span><span class="token plain">后，由&quot;javax.persistence&quot;更名为&quot;jakarta.persistence&quot; </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    &lt;classifier&gt;iakarta&lt;/classifier&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    &lt;versi0n&gt;5.0.0&lt;/version&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency</span><span class="token punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>QueryDSL,框架通过使用插件，为配置了@Entity 注解的实体自动创建 QBean(命名:&quot;Q&quot;+实体名)
QBean 是查询时的必要辅助类，可以通过面向对象的方式生成查询条件Predicate。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;bui1d</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;plugins</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;</span><span class="token tag" style="color:#00009f">!--</span><span class="token plain">添加QueryDSL插件支持</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &lt;plugin&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &lt;groupId&gt;com.mysema.maven&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &lt;artifactId&gt;apt.maven-plugin&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &lt;version&gt;1.1.3&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &lt;executions&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            	&lt;execution&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &lt;phase&gt;generate-sources&lt;/phase&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &lt;goals&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        &lt;goal&gt;process&lt;/goal&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &lt;/goals&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &lt;configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        &lt;!--QBean生成的路径需要加入&quot;Resources&quot;--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        &lt;outputDirectory&gt;target/generated-sources/qbean&lt;/outputDirectory&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        &lt;processor&gt;com.querydsl.apt.jpa.JPAAnnotationProcessor&lt;/processor&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                        &lt;log0nlyOnError&gt;true&lt;/log0nlyOnError&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &lt;/configuration&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            	&lt;/execution&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &lt;/executions&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &lt;dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &lt;groupId&gt;com.querydsl&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    cartifactId&gt;querydsl-apt&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &lt;!--JDK17后，由&quot;javax.persistence&quot;更名为&quot;jakarta.persistence&quot;--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                    &lt;classifier&gt;iakarta&lt;/classifier&gt;&lt;version&gt;5.0.0&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">                &lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            &lt;/dependencies&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        &lt;/plugin&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/plugins</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/build</span><span class="token punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置好插件后，可执行maven的&quot;compile&quot;自动生成QBean类</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42基本使用">4.2基本使用<a href="#42基本使用" class="hash-link" aria-label="Direct link to 4.2基本使用" title="Direct link to 4.2基本使用">​</a></h3>
<p>将自定义的数据访问接口继承 QuerydslPredicateExecutor接口，就可开始使用 QueryDSL 了。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 用户的Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface UserRepository extends JpaRepository&lt;User,Integer&gt;,QuerydslPredicateExecutor&lt;User&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//注意:必须继承父接口 JpaRepository，否则无法注入 UserRepository 的 Bean 对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//创建QBean对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QUser user = QUser.user;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//创建查询依据(条件)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Predicate predicate =null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//按id精确查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">predicate = user.cusId.eg(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optional&lt;User&gt; optional = userRepository.findone(predicate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//按 cusId in(1,2)查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">predicate = user.cusId.in(1,2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; userList = (List&lt;user&gt;) userRepository.findAll(predicate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//查询&quot;湖南&quot;的用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">predicate =user.cusAdd,like(&quot;%湖南%&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; userList = (List&lt;User&gt;) userRepository.findAll(predicate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//按 cusId &gt;= 3 的用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">predicate = user.cusId.goe(3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; userList = (List&lt;User&gt;) userRepository.findAll(predicate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//查询&quot;0731&quot;区号的用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">predicate =user.cusTel.startswith(&quot;0731&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; userList = (List&lt;User&gt;) userRepository.findAll(predicate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//联系地址为 null 的用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">predicate = user.cusAdd.isNull();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; userList = (List&lt;User&gt;) userRepository.findAll(predicate);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43动态查询">4.3动态查询<a href="#43动态查询" class="hash-link" aria-label="Direct link to 4.3动态查询" title="Direct link to 4.3动态查询">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 创建QBean对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QUser user = QUser.user:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 模拟前端的查询参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User userParam =new User();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userParam.setCusId(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userParam.setCusName(&quot;andy&quot;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userParam.setCusAdd(&quot;湖南长沙”);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//动态构造查询条件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BooleanBuilder builder = new BooleanBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (userParam.getCusId()!=null){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	builder.and(user.cusId.eq(userParam.getCusId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(userParam.getCusName()!=nu11){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.and(user.cusName.eq(userParam.getcusName()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(userParam.getCusAdd()!=null){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	builder.or(user.cusAdd.eq(userParam.getCusAdd()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//实现查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;User&gt; userList =(List&lt;user&gt;)userRepository.findAll(builder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//输出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">userList.forEach(System.out::println);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44框架小结">4.4框架小结<a href="#44框架小结" class="hash-link" aria-label="Direct link to 4.4框架小结" title="Direct link to 4.4框架小结">​</a></h3>
<p>优势:</p>
<ol>
<li>类型安全的査询构建：QueryDSL 使用 Java 来构建査询，可在编译时捕获到语法错误，避免了传统字符中查询的运行时异常。</li>
<li>简洁和直观的査询语法：使用 QueryDSL 可以将复杂的查询逻辑直观地表达为 Java 代码，提高了代码的可读性和可维护性。</li>
<li>支持多种持久化框架<!-- -->:QueryDSL<!-- --> 可以与多种主流的持久化框架集成，如 JPA、Hibernate、JDO 等，提供了统一的查询方式</li>
<li>动态查询的灵活性:可以根据不同的业务需求动态构建查询条件，使得查询逻辑更加灵活和可扩展。</li>
</ol>
<p>不足:</p>
<ol>
<li>需额外的引入依赖、插件</li>
<li>借助QBean实现，增加了代码量</li>
</ol>
<h1>SpringDataJPA-分页查询</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1分页查询的含义">1.分页查询的含义<a href="#1分页查询的含义" class="hash-link" aria-label="Direct link to 1.分页查询的含义" title="Direct link to 1.分页查询的含义">​</a></h2>
<p>分页查询将结果集分成 多个贞面，每个贞面包含一定数量的数据记录;分贞查询的主要目的是在处理大量数据时提高查询性能，给用户提供一种逐页查看数据的方式。</p>
<p>分页查询涉及的相关概念:</p>
<ol>
<li>页尺寸(pagesize)：即每一页显示的数据行数，通常由开发者人为确定</li>
<li>总数据量(total)：(指定条件下的)数据总行数</li>
<li>总页数(totalPages)：总页数需要通过计算，计算公式如: 总页数 = ceil(总数据量 / 页尺寸</li>
<li>当前页(pageNumber)：即当前展示的数据属于哪个页码</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2querybykxamplekxecutor接口">2.QueryBykxamplekxecutor接口<a href="#2querybykxamplekxecutor接口" class="hash-link" aria-label="Direct link to 2.QueryBykxamplekxecutor接口" title="Direct link to 2.QueryBykxamplekxecutor接口">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21分页方法概述">2.1分页方法概述<a href="#21分页方法概述" class="hash-link" aria-label="Direct link to 2.1分页方法概述" title="Direct link to 2.1分页方法概述">​</a></h3>
<p>QueryByExampleExecutor接口有关分页查询的方法，源码如下</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface ueryByExampleExecutor&lt;T&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //查找多个对象并分页显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	&lt;S extends T&gt; Page&lt;S&gt; findAll(Example&lt;S&gt; example, Pageable pageable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //其他方法&lt;略&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>说明如下:</p>
<ol>
<li>examgle用于控制分页查询的条件，该参数不允许null</li>
<li>pageable用于控制分页规格相关的参数，例如:页尺寸、当前页码(默认0)、上一页、下一页等</li>
<li>返回的对象用于获取分页查询相关的数据，例如:总数据量、总页数、当前页的数据集合、页尺寸等</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22分页查询条件">2.2分页查询条件<a href="#22分页查询条件" class="hash-link" aria-label="Direct link to 2.2分页查询条件" title="Direct link to 2.2分页查询条件">​</a></h3>
<p>example用于控制分页查询的条件，当无条件查询全表数据时，可以</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;Deposit&gt; example = Example.of(new Deposit());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Page&lt;Deposit&gt; page = depositRepository.findAll(example, pageable);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果需要指定查询的条件，可以</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Deposit searchDeposit = new Deposit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">searchDeposit.setDescrip(&quot;存款期&quot;);// 描述中以&quot;存款期&quot;开头的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example&lt;Deposit&gt; example = Example.of(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    searchDeposit,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ExampleMatcher.matching()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	.withstringMatcher(ExampleMatcher.stringMatcher.STARTING)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Page&lt;Deposit&gt; page = depositRepository.findAll(example, pageable);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-控制分页规格">2.3 控制分页规格<a href="#23-控制分页规格" class="hash-link" aria-label="Direct link to 2.3 控制分页规格" title="Direct link to 2.3 控制分页规格">​</a></h3>
<p>分页规格通常包含:页尺寸，当前页码，(是否有)上一页、(是否有)下一页、首尾页判断等方面
Pageable 接口提供了方法控制上述的各规格参数</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//构建包含页尺寸与当前页的Pageable对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pageable pageable=Pageable.ofsize(2).withPage(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//切换当前页</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pageable =pageable.first();// 将当前页切换至第一页</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pageable = pageable.previousOrFirst();//将当前贞切换至上一页或第一页</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pageable = pageable.next();//将当前页切换至下一页</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 是否存在上一页?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">boolean previous = pageable.hasPrevious();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//获取当前页码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int pageNumber = pageable.getPageNumber();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 获取页尺寸</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int pagesize = pageable.getPagesize();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>动态查询的条件，还可分别指定匹配的方式，然后再使用 or、and连接起来</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//1.构建(封装了查询条件的)实体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User searchUser=new User();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-获得查询数据">2.4 获得查询数据<a href="#24-获得查询数据" class="hash-link" aria-label="Direct link to 2.4 获得查询数据" title="Direct link to 2.4 获得查询数据">​</a></h3>
<p>分页查询的数据，包含:当前页面的数据集合、总页数、总数据量、页尺寸等
Page 接口提供了方法获取上述各项数据</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 执行分页查询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Page&lt;Deposit&gt; page = depositRepository,findAll(example, pageable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//获取当前页面的数据集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;Deposit&gt;depositList = page.getcontent();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 获取总页数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int totalPages = page.getTotalPages();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 获取总数据量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">long totalElements = page.getTotalElements();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 获取页尺寸</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int size = page.getsize();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3jpaspecifcationexecutor接口-1">3.JpaSpecifcationExecutor接口<a href="#3jpaspecifcationexecutor接口-1" class="hash-link" aria-label="Direct link to 3.JpaSpecifcationExecutor接口" title="Direct link to 3.JpaSpecifcationExecutor接口">​</a></h2>
<p>JpaSpecificationExecutor 提供的分页查询方法，与前面讲述的QueryByExampleExecutor 接口提供的分页查询方法几乎一样，区别就在于查询条件使用&quot;QBC&quot;方式构建。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface JpaspecificationExecutor&lt;T&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //查找多个对象并分页显示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Page&lt;T&gt; findAll(Specification&lt;T&gt; spec,Pageable pageable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>分页查询的操作演示如下:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//1.构建分页查询的条件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Specification&lt;Deposit&gt; spec = new specification&lt;Deposit&gt;(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Predicate toPredicate(Root&lt;Deposit&gt; root, CriteriaQuery&lt;?&gt; query,CriteriaBuilder cb){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		return cb.and();//相当于 where 1=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//2.构建分页规则相关参数(页尺寸、当前页)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pageable pageable=Pageable.ofsize(2).withPage(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//3.执行分贞查询，获取分贞数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Page&lt;Deposit&gt; page = depositRepository.findAll(spec, pageable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 4.获取当前页面的数据集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;Deposit&gt; depositList = page.getContent();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositList.forEach(System.out::println);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4querydsl-1">4.QueryDsL<a href="#4querydsl-1" class="hash-link" aria-label="Direct link to 4.QueryDsL" title="Direct link to 4.QueryDsL">​</a></h2>
<p>QueryDSL,是一个通用查询框架。使用它需要的依赖:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;</span><span class="token tag" style="color:#00009f">!--querydsl-jpa</span><span class="token plain"> 依赖</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;dependency</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.querydsl&lt;/groupId</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">querydsl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">jpa&lt;/artifactId</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;</span><span class="token tag" style="color:#00009f">!--JDK17</span><span class="token plain">后，由&quot;javax.persistence&quot;更名为&quot;jakarta.persistence&quot;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    &lt;classifier&gt;jakarta&lt;/classifier&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    &lt;version&gt;5.0.0&lt;/version&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency</span><span class="token punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>QueryDSL查询框架还需要配置一个插件，用于生成QBean(构建查询条件的Q类)。</p>
<p>配置好插件后，可执行 maven 的&quot;compile&quot;自动生成QBean类。
使用 QueryDSL 实现分页查询，与前面所讲解的几乎无异，区别也在于查询条件的构建 过程</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//1.构建分页查询的条件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0Deposit deposit = QDeposit.deposit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">com.querydsl.core.types.Predicate predicate = deposit .descrip.like(&quot;%&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//2.构建分页规则相关参数(页尺寸、当前页)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pageable pageable = Pageable.ofsize(2).withPage(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//3.执行分页查询，获取分页数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Page&lt;Deposit&gt; page = depositRepository.findAll(predicate, pageable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//4 获取当前页面的数据集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">List&lt;Deposit&gt; depositList = page.getcontent);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositList.forEach(System.out::println);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>SpringDataJPA-多表关联</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1多表关联的含义">1.多表关联的含义<a href="#1多表关联的含义" class="hash-link" aria-label="Direct link to 1.多表关联的含义" title="Direct link to 1.多表关联的含义">​</a></h2>
<p>在二维关系数据库中，数据表之间的关系是十分重要的概念，分成如下四种关系的类型:</p>
<ol>
<li>OneToOne:一对一关系。例如:一个国家一个首都、一夫一妻、一人一证等</li>
<li>OneToMany:一对多关系。例如:一个部门多个员工</li>
<li>ManyToOne:多对一关系，即一对多关系的反面。</li>
<li>ManyToMany:多对多关系。例如:用户与订单、学生与选课等</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2数据库表介绍">2.数据库表介绍<a href="#2数据库表介绍" class="hash-link" aria-label="Direct link to 2.数据库表介绍" title="Direct link to 2.数据库表介绍">​</a></h2>
<p>本集使用的相关数据表，描述如下:
1.部门信息表(tbl_dept)</p>
<table><thead><tr><th>id</th><th>dept_name</th></tr></thead><tbody><tr><td>部门id</td><td>部门名字</td></tr></tbody></table>
<p>2.入职信息表(tbl_join)</p>
<table><thead><tr><th>id</th><th>join_date</th></tr></thead><tbody><tr><td>入职id</td><td>入职日期</td></tr></tbody></table>
<p>3.员工信息表(tbl_emp)</p>
<table><thead><tr><th>id</th><th>emp_name</th><th>emp_gender</th><th>dept_id</th><th>join_id</th><th>emp_age</th></tr></thead><tbody><tr><td>员工id</td><td>员工姓名</td><td>员工性别</td><td>部门id</td><td>入职id</td><td>员工年龄</td></tr></tbody></table>
<p>4.任务信息表(tbl job)</p>
<table><thead><tr><th>id</th><th>job_name</th></tr></thead><tbody><tr><td>任务id</td><td>任务名字</td></tr></tbody></table>
<p>5.员工-任务关系衣(tbl_emp_job)</p>
<table><thead><tr><th>id</th><th>emp_id</th><th>job_id</th></tr></thead><tbody><tr><td>关系id</td><td>任务id</td><td>员工id</td></tr></tbody></table>
<p>各表之间的关联关系</p>
<ol>
<li>一对一关系:员工信息表 vs 入职信息表</li>
<li>一对多关系:部门信息表 vs 员工信息表</li>
<li>多对一关系:员工信息表 vs 部门信息表</li>
<li>多对多关系:员工信息表 vs 任务信息表d</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3一对一关系">3.一对一关系<a href="#3一对一关系" class="hash-link" aria-label="Direct link to 3.一对一关系" title="Direct link to 3.一对一关系">​</a></h2>
<p>表A中的一行记录，在表B中只能找到唯一关联的一行记录，而不是多行记录，这就是一对一。</p>
<p>关联关系中的两张表，通常会划分成&quot;主控方&quot;和&quot;被控方&quot;，以免两方都去维护关系导致冲突。</p>
<p>本集设计一对一关系的两张表，以及他们的&quot;主、被控方&quot;地位如下:</p>
<ol>
<li>主控方：员工信息表(tbl_emp) -&gt; 关联字段(join_id)</li>
<li>被控方：入职信息表(tbl join) -&gt; 关联字段(id)</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-joincolumn">3.1 @JoinColumn<a href="#31-joincolumn" class="hash-link" aria-label="Direct link to 3.1 @JoinColumn" title="Direct link to 3.1 @JoinColumn">​</a></h3>
<p>@JoinColumn 用于设置表的关联字段，通常在“主控方”的实体中使用。语法如:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@JoinColumn(name =&quot;主控方关联字段或命名正确的关联属性&quot;,referencedcolumnName=&quot;被控方的关联属性(默认为被控方主键)&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>由于注解能自动生成关联字段，原来实体类中手动添加的关联属性需要注释，否则会引发字段的异常!</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Employe {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...其他属性&lt;略&gt;..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //private Integer joinId;  //入职信息id(此属性需要手动注释掉)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @JoinColumn(name =&quot;joinId&quot;,referencedColumnName = &quot;id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private JoinInfo join;//入职信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-onetoone">3.2 @OneToOne<a href="#32-onetoone" class="hash-link" aria-label="Direct link to 3.2 @OneToOne" title="Direct link to 3.2 @OneToOne">​</a></h3>
<p>@OneToOne 注解用于定义两个实体之间的一对一关系，可在关系的双方编写或其中一方编写,具体的编写位置是在实体的关联属性上。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-单向关联与双向关联">3.3 单向关联与双向关联<a href="#33-单向关联与双向关联" class="hash-link" aria-label="Direct link to 3.3 单向关联与双向关联" title="Direct link to 3.3 单向关联与双向关联">​</a></h3>
<p>单向和双向关联的区别就在于,两个表的数掘是否需要互相知道;</p>
<p>单向关联仅支持单向的数据引用，即通过查询表A的数据可查到关联的表B数据，反过来却不行;</p>
<p>双向关联则更进一步，不仅支持双向的数据引用，还能确保两个表之问的数据同步变化。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//单向一对一关联示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Employe {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...其他属性&lt;略&gt;..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OneToOne //员工与入职是一对一的关系</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @JoinColumn(name =&quot;joinId&quot;,referencedcolumnName = &quot;id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private JoinInfo join; //入职信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-双向关联的循环引用问题">3.4 双向关联的循环引用问题<a href="#34-双向关联的循环引用问题" class="hash-link" aria-label="Direct link to 3.4 双向关联的循环引用问题" title="Direct link to 3.4 双向关联的循环引用问题">​</a></h3>
<p>在处理双向关联时可能会导致循环引用,从而引发 StackOverflowError(堆栈溢出)的错误，如:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Optional&lt;Employe&gt;optional1 = employeRespository.findById(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//查询员工的同时查询关联的入职信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optional1.ifpresent(emp-&gt;system.out.printn(&quot;emp =&quot;+ emp));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>错误原因在对象的输出语句上。因 Employe 实体类的 @Data 注解帮助自动生成了 toString()方法，而该方法中包含输出关联对象join，而在输出关联 join 时又会要求输出其反向关联的对象emp，从而导致循环引用的问题。</p>
<p>解决办法:自定义 toString()方法，将其中一方(或双方)的输出语句中去掉关联对象的输出!</p>
<p>另外，为避免双向关联的循环引用导致序列化时的错误，在主控方、被控方的关联属性上分别使用@JsonManagedReferénce 注解和 @JsonBackReference 注解，例如:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//双向一对一关联示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Employe {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//...其他属性&lt;略&gt;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@OneToOne</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@JoinColumn(name =&quot;joinId&quot;,referencedcolumnName = &quot;id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@JsonManagedReference //主控方</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4多对一一对多">4.多对一/一对多<a href="#4多对一一对多" class="hash-link" aria-label="Direct link to 4.多对一/一对多" title="Direct link to 4.多对一/一对多">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-manytoone">4.1 @ManyToOne<a href="#41-manytoone" class="hash-link" aria-label="Direct link to 4.1 @ManyToOne" title="Direct link to 4.1 @ManyToOne">​</a></h3>
<p>员工与部门，是属于多对一的关系</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 单向多对一关联示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Employe {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...其他属性&lt;略&gt;..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //private Integer deptId; // 部门id需注释掉</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ManyToOne</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @JoinColumn(name =&quot;deptId&quot;,referencedColumnName =&quot;id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Department department;//部门信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-onetomany">4.2 @OneToMany<a href="#42-onetomany" class="hash-link" aria-label="Direct link to 4.2 @OneToMany" title="Direct link to 4.2 @OneToMany">​</a></h3>
<p>部门与员工，是属于一对多的关系</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 双向多对一、一对多关联示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Employe {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...其他属性&lt;略&gt;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ManyToone//员工与部门是多对一的关系</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Joincolumn(name =&quot;deptId&quot;,referencedcolumnName = &quot;id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Department department;//部门信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Department{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...其他属性&lt;略&gt;..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @oneToMany(mappedBy =&quot;department&quot;)//部门与员工是一对多的关系</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;Employe&gt; employeList;//员工信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意事项:</p>
<ol>
<li>双向关联的循环引用问题</li>
<li>通过部门查询员工集合时(一对多的多方)，由于员工集合的数掘会延迟加载，为保证数据一致性,需要在方法上加上事务控制。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5多对多关系">5.多对多关系<a href="#5多对多关系" class="hash-link" aria-label="Direct link to 5.多对多关系" title="Direct link to 5.多对多关系">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-manytomany">5.1 @ManyToMany<a href="#51-manytomany" class="hash-link" aria-label="Direct link to 5.1 @ManyToMany" title="Direct link to 5.1 @ManyToMany">​</a></h3>
<p>员工与任务，是属于多对多的关系。多对多关系设计通常是专门创建一个表来阐述关系。</p>
<p>tbl_emp_job表</p>
<table><thead><tr><th>id</th><th>emp_id</th><th>job_id</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>1</td></tr><tr><td>2</td><td>1</td><td>2</td></tr><tr><td>3</td><td>2</td><td>3</td></tr><tr><td>4</td><td>3</td><td>3</td></tr><tr><td>5</td><td>4</td><td>4</td></tr></tbody></table>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 多对多关联示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Employe {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...其他属性&lt;略&gt;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @мanyToMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;Job&gt; jobList;//任务信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Job{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...其他属性&lt;略&gt;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @мanyToMany(mappedBy =&quot;jobList&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;Employe&gt; jobList;//员工信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-jointable">5.2 @JoinTable<a href="#52-jointable" class="hash-link" aria-label="Direct link to 5.2 @JoinTable" title="Direct link to 5.2 @JoinTable">​</a></h3>
<p>在 @ManyToMany 关系中，@JoinTable 注解用于指定关系表，以及关联的字段</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Employe{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...其他属性&lt;略&gt;..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	@ManyToMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @JoinTable(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name =&quot;tbl_emp_job&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    joinColumns = @Joincolumn(name =&quot;emp_id&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inverseJoincolumns = @JoinColumn(name =&quot;job_id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;Job&gt; jobList;//任务信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意事项:</p>
<ol>
<li>双向关联的循环引用问题</li>
<li>数据延迟加载，需要在方法上加上事务控制。</li>
</ol>
<h1>SpringDataJPA-级联操作</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1级联的含义">1.级联的含义<a href="#1级联的含义" class="hash-link" aria-label="Direct link to 1.级联的含义" title="Direct link to 1.级联的含义">​</a></h2>
<p>级联(cascade)，是在建立了关联关系的实体之间，由一方对象执行操作，另一方对象会同步执行相同操作的现象。级联的目的在于提高数据管理的效率。</p>
<ol>
<li>新增员工信息，员工的入职信息也需要新增</li>
<li>删除一篇文章时，相关的评论也需要被删除</li>
</ol>
<p>在 SpringData]PA 中实现级联，可通过 @OneToOne|@OneToMany|@ManyToOne@ManyToMany注解的属性&quot;cascade&quot;来完成。如:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@ManyToMany(cascade = CascadeType.ALL)// 全部级联</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ManyToMany(cascade = cascadeType.PERSIST)// 级联新增</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ManyToMany(cascade = CascadeType.REMOVE)// 级联删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ManyToMany(cascade = CascadeType.MERGE)// 级联更新</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>本集涉及到的数据表描述如下:
注意:数据库库之中并未设计表间的主-外键，而是交由 java 程序处理。</p>
<p>1.入职信息表(tbl_join)</p>
<table><thead><tr><th>id</th><th>join_date</th></tr></thead><tbody><tr><td>入职id</td><td>入职日期</td></tr></tbody></table>
<p>2.员工信息表(tbl_emp)</p>
<table><thead><tr><th>id</th><th>emp_name</th><th>emp_gender</th><th>join_id</th><th>dept_id</th><th>emp_age</th></tr></thead><tbody><tr><td>员工id</td><td>员工姓名</td><td>员工性别</td><td>入职id</td><td>部门id</td><td>员工年龄</td></tr></tbody></table>
<p>3.任务信息表(tbl_job)</p>
<table><thead><tr><th>id</th><th>job_name</th></tr></thead><tbody><tr><td>任务id</td><td>任务名字</td></tr></tbody></table>
<p>4.员工-任务关系表(tbl_emp_job)</p>
<table><thead><tr><th>id</th><th>emp_id</th><th>job_id</th></tr></thead><tbody><tr><td>关系id</td><td>员工id</td><td>任务id</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2级联新增">2.级联新增<a href="#2级联新增" class="hash-link" aria-label="Direct link to 2.级联新增" title="Direct link to 2.级联新增">​</a></h2>
<p>级联方式设定为<!-- -->:CascadeType<!-- -->.PERSIST</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21单向关联的级联新增">2.1单向关联的级联新增<a href="#21单向关联的级联新增" class="hash-link" aria-label="Direct link to 2.1单向关联的级联新增" title="Direct link to 2.1单向关联的级联新增">​</a></h3>
<p>单向关联时，因被控方未设置关联属性，所以仅主控方新增才引发级联新增，注意必须为主控方的关联属性赋值。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//主控方新增(单向一对一)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Employe employe = new Employe(null,&quot;王二麻子&quot;,&quot;男&quot;,33,3,null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Join join =new Join(null,new Date());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 省略仅新增employe，不执行级联</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.setJoin(join);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employeRespository.save(employe);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23双向关联的级联新增">2.3双向关联的级联新增<a href="#23双向关联的级联新增" class="hash-link" aria-label="Direct link to 2.3双向关联的级联新增" title="Direct link to 2.3双向关联的级联新增">​</a></h3>
<p>双向关联时，双方新增都可以引发级联新增，注意必须为操作方的关联属性赋值。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 主控方新增(双向一对一)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Employe employe = new Employe(null,&quot;王二麻子&quot;,，&quot;男&quot;，33，1，null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Join join =new Join(null,new Date()，null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.setJoin(join);//不可省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//join.setEmploye(employe);// 可省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employeRespository.save(employe);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 被控方新增(双向一对一)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Employe employe =new Employe(null，&quot;王二麻子&quot;&quot;男&quot;，33，1，nul1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Join join = new Join(null,new Date()，null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.setJoin(join);//省略则入职id为nu11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">join.setEmploye(employe);//不可省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">joinRespository.save(join);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24多对多关联的级联新增">2.4多对多关联的级联新增<a href="#24多对多关联的级联新增" class="hash-link" aria-label="Direct link to 2.4多对多关联的级联新增" title="Direct link to 2.4多对多关联的级联新增">​</a></h3>
<p>多对多双向关联时，双方新增都可以引发级联新增，注意必须为操作方的关联属性赋值。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//主控方新增(双向多对多)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Employe employe = new Employe(null,&quot;王二子&quot;,&quot;男&quot;,33,3,1,null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Job job =new Job(nu]l,&quot;销售&quot;null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.setJobList(Arrays.asList(job));//不可省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//job.setEmployeList(Arrays.asList(employe));//可省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employeRespository.save(employe);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 被控方新增(双向多对多)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Employe employe = new Employe(null,&quot;王二麻子&quot;,&quot;男&quot;,33,3,1,null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Job job = new Job(null,&quot;销售&quot;null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.setJobList(Arrays.asList(job));//省略则不添加关系表数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">job.setEmployeList(Arrays.asList(employe));//不可省略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jobRespository.save(job);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3级联删除">3.级联删除<a href="#3级联删除" class="hash-link" aria-label="Direct link to 3.级联删除" title="Direct link to 3.级联删除">​</a></h2>
<p>级联方式设定为<!-- -->:CascadeType<!-- -->.REMOVE</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31单向关联的级联删除">3.1单向关联的级联删除<a href="#31单向关联的级联删除" class="hash-link" aria-label="Direct link to 3.1单向关联的级联删除" title="Direct link to 3.1单向关联的级联删除">​</a></h3>
<p>单向关联时，仅主控方删除才引发级联删除。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 主控方删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employeRespository.deleteById(1);//既删除employe,又删除join</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 被控方删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">joinRespository.deleteById(2);//仅删除join,不删除employe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-双向关联的级联删除">3.2 双向关联的级联删除<a href="#32-双向关联的级联删除" class="hash-link" aria-label="Direct link to 3.2 双向关联的级联删除" title="Direct link to 3.2 双向关联的级联删除">​</a></h3>
<p>双向关联时，双方都可引发级联删除，删除数据范围较广极易误删，不推荐配置!</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 主控方删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employeRespository.deleteById(1);//既删除employe,又删除join</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 被控方删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">joinRespository.deleteById(2);//既删除employe,又删除join</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33多对多关联的级联删除">3.3多对多关联的级联删除<a href="#33多对多关联的级联删除" class="hash-link" aria-label="Direct link to 3.3多对多关联的级联删除" title="Direct link to 3.3多对多关联的级联删除">​</a></h3>
<p>多对多的级联删除是指任意一方执行删除操作时，级联删除另一方表和关系表中的相关数据。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 主控方删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employeRespository.deleteById(1); // 既删除employe,又删除关系表数据,还删除job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//被控方删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jobRespository.deleteById(3);//既删除job,又删除关系表数据,还删除employe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>小结:多对多的级联删除需谨慎再谨慎，不推荐配置级联删除!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4级联更新">4.级联更新<a href="#4级联更新" class="hash-link" aria-label="Direct link to 4.级联更新" title="Direct link to 4.级联更新">​</a></h2>
<p>级联方式设定为<!-- -->:CascadeType<!-- -->.MERGE</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41单向关联的级联修改">4.1单向关联的级联修改<a href="#41单向关联的级联修改" class="hash-link" aria-label="Direct link to 4.1单向关联的级联修改" title="Direct link to 4.1单向关联的级联修改">​</a></h3>
<p>单向关联时，因被控方未设置关联属性，所以仅主控方更新才引发级联更新。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 主控方对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Employe employe =employeRespository.findA1l().get(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//修改主控方对象的年龄属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.setEmpAge(35):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//修改关联对象的入职日期属性(重点)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.getJoin().setJoinDate(new Date());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//提交主控方对象的修改(持久化会同样作用到关联对象)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employeRespository.save(employe);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-双向关联的级联修改">4.2 双向关联的级联修改<a href="#42-双向关联的级联修改" class="hash-link" aria-label="Direct link to 4.2 双向关联的级联修改" title="Direct link to 4.2 双向关联的级联修改">​</a></h3>
<p>双向关联时，主控方发起级联修改的编码与单向关联一样，这里只给出被控方如何发起级联修改。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 被控方对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Join join = joinRespository.findAll().get(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//修改被控方对象的年龄属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">join.setJoinDate(new Date());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 修改关联对象的年龄属性(重点)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">join.getEmploye().setEmpAge(35);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//提交被控方对象的修改(持 久化会同样作用到关联对象)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">joinRespository.save(join);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43多对多关联的级联修改">4.3多对多关联的级联修改<a href="#43多对多关联的级联修改" class="hash-link" aria-label="Direct link to 4.3多对多关联的级联修改" title="Direct link to 4.3多对多关联的级联修改">​</a></h3>
<p>多对多的级联修改是指任意一方执行修改操作时，级联修改另一方表中的相关数据;
由于获取&quot;多方&quot;的数据时采用延迟加载，方法需要添加 @Transactional注解，但是该注解默认情况下不会自动提交，因此还需配合 @Commit 注解。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 主控方对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Employe employe =employeRespository.findAll().get(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//修改主控方对象的年龄属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.setEmpAge(35);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//修改关联对象的属性(重点)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.getJobList().get(0).setJobName(&quot;xuqiufenxi&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.getJobList().add(jobRespository.findById(3).get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employe.getJobList().remove(jobRespository.findById(1).get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employeRespository.save(employe);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//提交主控方对象的修改(持久化会同样作用到关系表数据)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">employeRespository.save(employe);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 被控方对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Job job =jobRespository.findById(1).get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//修改被控方对象的任务名字属性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">job.setJobName(&quot;develop&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//修改关联对象的年龄属性(重点)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">job.getEmployeList().get(0).setEmpAge(40);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//提交被控方对象的修改(持久化会同样作用到关系表数据)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jobRespository.save(job);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5总结">5.总结<a href="#5总结" class="hash-link" aria-label="Direct link to 5.总结" title="Direct link to 5.总结">​</a></h2>
<p>单向关联时，仅主控方才可引发级联操作;
双向关联时，主、被控双方均可引发级联操作;
不建议配置级联删除。</p>
<h1>SpringDataJPA-审计功能</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1审计的含义">1.审计的含义<a href="#1审计的含义" class="hash-link" aria-label="Direct link to 1.审计的含义" title="Direct link to 1.审计的含义">​</a></h2>
<p>审计(Auditing)，原意是对资料作出证据搜集及分析，以评估企业财务状况，最后就资料及一般公认准则之间的相关程度，作出审计结论及报告。
JPA 提供审计的相关注解，可轻松实现上述的自动跟踪，减少代码量。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//创建新增的实体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deposit deposit =new Deposit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deposit.setsavingName(&quot;存本取息五年&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deposit.setDescrip(&quot;按月支取利息&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//手动维护审计相关字段</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deposit.setcreateBy(&quot;张三&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deposit.setCreateAt(LocalDateTime.now());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deposit.setupdateBy(&quot;张三&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deposit.setUpdateAt(LocalDateTime .now());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 执行新增</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.save(deposit);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//创建新增的实体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deposit deposit=new Deposit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deposit.setsavingName(&quot;存本取息五年&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deposit.setDescrip(&quot;按月支取利息&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 执行新增</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">depositRepository.save(deposit);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 SpringData]PA 中实现审计相关字段自动维护，可通过下面几个注解来完成</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@EnableJpaAuditing //开启JPA审计功能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@CreatedDate // 跟踪创建时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@LastModifiedDate // 跟踪修改时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@CreatedBy // 跟踪创建人</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@LastModifiedBy // 跟踪修改人</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EntityListeners //监听实体的增删改查操作</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2开启审计">2.开启审计<a href="#2开启审计" class="hash-link" aria-label="Direct link to 2.开启审计" title="Direct link to 2.开启审计">​</a></h2>
<p>@EnableJpaAuditing 注解用于启用 JPA的审计功能，该注解仅可作用于类上面，常见在应用的启动类或者 JPA配置类上进行添加</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableJpaAuditing //启用 JPA 的审计功能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Jpaconfiguration{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...代码&lt;略&gt;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3监听实体">3.监听实体<a href="#3监听实体" class="hash-link" aria-label="Direct link to 3.监听实体" title="Direct link to 3.监听实体">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-entitylisteners">3.1 @EntityListeners<a href="#31-entitylisteners" class="hash-link" aria-label="Direct link to 3.1 @EntityListeners" title="Direct link to 3.1 @EntityListeners">​</a></h3>
<p>@EntityListeners 注解用于监听实体的CURD操作(没错，查询也可监听);
该注解仅可作用于类上面;该注解仅有一个 Class 数组类型的 value 属性，用于指定监听器类。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Target({TYPE})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Retention(RUNTIME)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public @interface EntityListeners{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**The callback listener classes */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class[] value();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-监听器类">3.2 监听器类<a href="#32-监听器类" class="hash-link" aria-label="Direct link to 3.2 监听器类" title="Direct link to 3.2 监听器类">​</a></h3>
<p>JPA 提供的监听器类 AuditingEntityListener ，审计功能就是通过该类中的方法实现监听的。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@EntityListeners(value ={AuditingEntityListener.class,})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class peposit{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	//...代码&lt;略&gt;...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configurable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AuditingEntityListener{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //...其他代码&lt;略&gt;..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PrePersist //实体即将被保存到数据库之前调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void touchForcreate(object target){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //...代码&lt;略&gt;...11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PreUpdate //实体即将被更新到数据库之前调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void touchForupdate(object target){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //...代码&lt;略&gt;。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 补充:用法见&quot;自定义监听器&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PostPersist:实体已经被成功保存到数据库之后调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Postupdate:实体已经被更新到数据库之后调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PreRemove:实体即将从数据库中删除之前调用。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PostRemove:实体已经被从数据库中删除之后调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@PostLoad:实体从数据库加载到内存后调用[查询]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//注意:上述7个注解只能作用在方法上</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4跟踪创建时间和修改时间">4.跟踪创建时间和修改时间<a href="#4跟踪创建时间和修改时间" class="hash-link" aria-label="Direct link to 4.跟踪创建时间和修改时间" title="Direct link to 4.跟踪创建时间和修改时间">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-createddate">4.1 @CreatedDate<a href="#41-createddate" class="hash-link" aria-label="Direct link to 4.1 @CreatedDate" title="Direct link to 4.1 @CreatedDate">​</a></h3>
<p>@CreatedDate 注解用于跟踪创建时间，该注解可作用于属性、方法和其他注解上。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@CreatedDate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private LocalDateTime createAt;//创建时间</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-lastmodifeddate">4.2 @LastModifedDate<a href="#42-lastmodifeddate" class="hash-link" aria-label="Direct link to 4.2 @LastModifedDate" title="Direct link to 4.2 @LastModifedDate">​</a></h3>
<p>@LastModifiedDate 注解用于跟踪修改时间，该注解可作用于属性、方法和其他注解上。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@LastModifiedDate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private LocalDateTime updateAt;//修改时间</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-测试">4.3 测试<a href="#43-测试" class="hash-link" aria-label="Direct link to 4.3 测试" title="Direct link to 4.3 测试">​</a></h3>
<p>在前述增加实体的代码基础上，注释掉创建时间、修改时间的编码,由相关注解自动填充其值</p>
<p>修改新增的实体，观察createAt和updateAt修改前后的值变化</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5跟踪创建人和修改人">5.跟踪创建人和修改人<a href="#5跟踪创建人和修改人" class="hash-link" aria-label="Direct link to 5.跟踪创建人和修改人" title="Direct link to 5.跟踪创建人和修改人">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-createdby">5.1 @CreatedBy<a href="#51-createdby" class="hash-link" aria-label="Direct link to 5.1 @CreatedBy" title="Direct link to 5.1 @CreatedBy">​</a></h3>
<p>@CreatedBy 注解用于跟踪创建人信息，该注解可作用于属性、方法和其他注解上。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@CreatedBy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private string createBy; //创建人</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-lastmodifedby">5.2 @LastModifedBy<a href="#52-lastmodifedby" class="hash-link" aria-label="Direct link to 5.2 @LastModifedBy" title="Direct link to 5.2 @LastModifedBy">​</a></h3>
<p>@LastModifiedBy 注解用于跟踪修改人信息，该注解可作用于属性、方法和其他注解上。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@LastModifiedBy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private string updateBy;//修改人</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-auditoraware接">5.3 AuditorAware接<a href="#53-auditoraware接" class="hash-link" aria-label="Direct link to 5.3 AuditorAware接" title="Direct link to 5.3 AuditorAware接">​</a></h3>
<p>跟踪创建人和修改人之前，JPA 需要事先知晓以何种形式描述被跟踪人，例如:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@CreatedBy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private string createBy;//使用字符串描述，例如:用户名字符串表示被跟踪人</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@CreatedBy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private Integer createBy;//使用Integer描述，例如:用户Id表示被跟踪人</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@CreatedBy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private User createBy;//使用User类描述，例如:用户实体表示被跟踪人</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在做审计的实体类上确认被跟踪人的描述形式以后，还需要确认审计属性的值如何填充。</p>
<p>JPA提供了 AuditorAware 接口，用于提供创建人和修改人的值。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableJpaAuditing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Jpaconfiguration{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AuditorAwarekstring&gt; auditorAware(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new AuditorAware&lt;string&gt;(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            public optional&lt;string&gt; getCurrentAuditor(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //使用字符串描述被跟踪人(通常是当前登录的用户)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return optional.of(&quot;老李&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54测试">5.4测试<a href="#54测试" class="hash-link" aria-label="Direct link to 5.4测试" title="Direct link to 5.4测试">​</a></h3>
<p>1.在前述增加实体的代码基础上，注释掉创建人、修改人的编码，由相关注解自动填充其值</p>
<p>2.重新测试增加实体，手动设置创建人、修改人的值，观察createBy和updateBy的值</p>
<p>3.修改新增的实体，手动设置创建人、修改人的值，观察createBy和updateBy修改前后的值变化</p>
<p>小结:通过上述测试得知，新增实体时 AuditorAware 接口最终决定创建人、修改人的值，修改实体时可手动决定创建人的值，无法手动决定修改人的值。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6自定义监听器">6.自定义监听器<a href="#6自定义监听器" class="hash-link" aria-label="Direct link to 6.自定义监听器" title="Direct link to 6.自定义监听器">​</a></h2>
<p>仅仅使用 JPA 提供的监听器无法整合业务(例如:通过日志记录实体数据变化的过程)，因此可以自定义审计监听器。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MyAuditingEntityListener{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostLoad</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	private void postLoad(object entity){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	log.info(&quot;查询{}&quot;，entity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PrePersist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void prePersist(object entity){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;新增前 {}&quot;，entity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostPersist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void postPersist(object entity){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;新增后 {}&quot;，entity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PreUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void preUpdate(object entity){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;更新前 {}&quot;，entity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void postupdate(object entity){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;更新后 {}&quot;，entity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PreRemoveprivate void preRemove(object entity){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;删除前 {}&quot;，entity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostRemove</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void postRemove(object entity){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;删除后 {}&quot;，entity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/qinzhihao-conghua/docs/知识与技能点/SpringDataJPA/SpringDataJPA.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-summary/docs/知识与技能点/Prompt提示词/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Prompt提示词</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-summary/docs/知识与技能点/apk反编译/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">apk反编译</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1入门概念" class="table-of-contents__link toc-highlight">1.入门概念</a><ul><li><a href="#11什么是jpa" class="table-of-contents__link toc-highlight">1.1什么是JPA</a></li><li><a href="#12为什么需要jpa" class="table-of-contents__link toc-highlight">1.2为什么需要JPA</a></li></ul></li><li><a href="#初始化" class="table-of-contents__link toc-highlight">初始化</a><ul><li><a href="#22-applicationyml" class="table-of-contents__link toc-highlight">2.2 application.yml</a></li><li><a href="#23创建库表" class="table-of-contents__link toc-highlight">2.3创建库表</a></li><li><a href="#24创建实体类" class="table-of-contents__link toc-highlight">2.4创建实体类</a></li><li><a href="#25-自定义jpa操作接口" class="table-of-contents__link toc-highlight">2.5 自定义JPA操作接口</a></li></ul></li><li><a href="#1什么是反向建表" class="table-of-contents__link toc-highlight">1.什么是反向建表</a></li><li><a href="#2反向建表相关注解" class="table-of-contents__link toc-highlight">2.反向建表相关注解</a><ul><li><a href="#21-entity" class="table-of-contents__link toc-highlight">2.1 @Entity</a></li><li><a href="#22-table" class="table-of-contents__link toc-highlight">2.2 @Table</a></li><li><a href="#23-column" class="table-of-contents__link toc-highlight">2.3 @Column</a></li><li><a href="#24-id" class="table-of-contents__link toc-highlight">2.4 @Id</a></li><li><a href="#25-generatedvalue" class="table-of-contents__link toc-highlight">2.5 @GeneratedValue</a></li></ul></li><li><a href="#3反向建表的启动配置" class="table-of-contents__link toc-highlight">3.反向建表的启动配置</a></li><li><a href="#4查看sql语句" class="table-of-contents__link toc-highlight">4.查  看SQL语句</a></li><li><a href="#5创建表索引" class="table-of-contents__link toc-highlight">5.创建表索引</a></li><li><a href="#1save方法" class="table-of-contents__link toc-highlight">1.save方法</a></li><li><a href="#2局部更新" class="table-of-contents__link toc-highlight">2.局部更新</a><ul><li><a href="#21自定义更新方法" class="table-of-contents__link toc-highlight">2.1自定义更新方法</a></li><li><a href="#22-query注解" class="table-of-contents__link toc-highlight">2.2 @Query注解</a></li></ul></li><li><a href="#3动态更新" class="table-of-contents__link toc-highlight">3.动态更新</a><ul><li><a href="#31-dynamicupdate" class="table-of-contents__link toc-highlight">3.1 @DynamicUpdate</a></li><li><a href="#32完善动态更新" class="table-of-contents__link toc-highlight">3.2完善动态更新</a></li></ul></li><li><a href="#1常规删除操作" class="table-of-contents__link toc-highlight">1.常规删除操作</a><ul><li><a href="#11-按id删除" class="table-of-contents__link toc-highlight">1.1 按ID删除</a></li><li><a href="#12-按对象删除" class="table-of-contents__link toc-highlight">1.2 按对象删除</a></li><li><a href="#13全表删除" class="table-of-contents__link toc-highlight">1.3全表删除</a></li></ul></li><li><a href="#2批量删除操作" class="table-of-contents__link toc-highlight">2.批量删除操作</a><ul><li><a href="#21按id批量删除" class="table-of-contents__link toc-highlight">2.1按ID批量删除</a></li><li><a href="#22-按对象集合批量删除" class="table-of-contents__link toc-highlight">2.2 按对象集合批量删除</a></li></ul></li><li><a href="#3自定义删除操作" class="table-of-contents__link toc-highlight">3.自定义删除操作</a><ul><li><a href="#31自定义删除方法" class="table-of-contents__link toc-highlight">3.1自定义删除方法</a></li><li><a href="#32-声明式删除方法" class="table-of-contents__link toc-highlight">3.2 声明式删除方法</a></li></ul></li><li><a href="#1逻辑删除" class="table-of-contents__link toc-highlight">1.逻辑删除</a><ul><li><a href="#11表结构的更改" class="table-of-contents__link toc-highlight">1.1表结构的更改</a></li><li><a href="#12-sqldelete" class="table-of-contents__link toc-highlight">1.2 @SQLDelete</a></li><li><a href="#13-测试逻辑删除" class="table-of-contents__link toc-highlight">1.3 测试逻辑删除</a></li></ul></li><li><a href="#2物理删除" class="table-of-contents__link toc-highlight">2.物理删除</a><ul><li><a href="#21-自定义sql删除" class="table-of-contents__link toc-highlight">2.1 自定义SQL删除</a></li><li><a href="#22-inbatch删除" class="table-of-contents__link toc-highlight">2.2 InBatch删除</a></li></ul></li><li><a href="#3逻辑删除的影响" class="table-of-contents__link toc-highlight">3.逻辑删除的影响</a><ul><li><a href="#31对查询的影响" class="table-of-contents__link toc-highlight">3.1对查询的影响</a></li><li><a href="#32-对修改的影响" class="table-of-contents__link toc-highlight">3.2 对修改的影响</a></li><li><a href="#33-preremove" class="table-of-contents__link toc-highlight">3.3 @PreRemove</a></li></ul></li><li><a href="#1查询方式分类" class="table-of-contents__link toc-highlight">1.查询方式分类</a></li><li><a href="#2继承jparepository-接口" class="table-of-contents__link toc-highlight">2.继承JpaRepository 接口</a><ul><li><a href="#21-listcrudrepository接口" class="table-of-contents__link toc-highlight">2.1 ListCrudRepository接口</a></li><li><a href="#22-listpagingandsortingrepository接口" class="table-of-contents__link toc-highlight">2.2 ListPagingAndSortingRepository接口</a></li><li><a href="#23-querybyexampleexecutor接囗" class="table-of-contents__link toc-highlight">2.3 QueryByExampleExecutor接囗</a></li></ul></li><li><a href="#3使用jpql实现查询" class="table-of-contents__link toc-highlight">3.使用JPQL实现查询</a><ul><li><a href="#31什么是jpql" class="table-of-contents__link toc-highlight">3.1什么是JPQL</a></li><li><a href="#32定义jpql查询方法" class="table-of-contents__link toc-highlight">3.2定义JPQL查询方法</a></li></ul></li><li><a href="#4使用原生-sql实现查询" class="table-of-contents__link toc-highlight">4.使用原生 SQL实现查询</a></li><li><a href="#5使用声明式方法实现查询" class="table-of-contents__link toc-highlight">5.使用&quot;声明式&quot;方法实现查询</a></li><li><a href="#1动态查询的含义" class="table-of-contents__link toc-highlight">1.动态查询的含义</a></li><li><a href="#2querybyexampleexecutor接口" class="table-of-contents__link toc-highlight">2.QueryByExampleExecutor接口</a><ul><li><a href="#21接口概述" class="table-of-contents__link toc-highlight">2.1接口概述</a></li><li><a href="#22基本使用" class="table-of-contents__link toc-highlight">2.2基本使用</a></li><li><a href="#23动态查询" class="table-of-contents__link toc-highlight">2.3动态查询</a></li><li><a href="#24接口小结" class="table-of-contents__link toc-highlight">2.4接口小结</a></li></ul></li><li><a href="#3jpaspecifcationexecutor接口" class="table-of-contents__link toc-highlight">3.JpaSpecifcationExecutor接口</a><ul><li><a href="#31接口概述" class="table-of-contents__link toc-highlight">3.1接口概述</a></li><li><a href="#32基本使用" class="table-of-contents__link toc-highlight">3.2基本使用</a></li><li><a href="#33动态查询" class="table-of-contents__link toc-highlight">3.3动态查询</a></li><li><a href="#34接口小结" class="table-of-contents__link toc-highlight">3.4接口小结</a></li></ul></li><li><a href="#4querydsl" class="table-of-contents__link toc-highlight">4.QueryDSL</a><ul><li><a href="#42基本使用" class="table-of-contents__link toc-highlight">4.2基本使用</a></li><li><a href="#43动态查询" class="table-of-contents__link toc-highlight">4.3动态查询</a></li><li><a href="#44框架小结" class="table-of-contents__link toc-highlight">4.4框架小结</a></li></ul></li><li><a href="#1分页查询的含义" class="table-of-contents__link toc-highlight">1.分页查询的含义</a></li><li><a href="#2querybykxamplekxecutor接口" class="table-of-contents__link toc-highlight">2.QueryBykxamplekxecutor接口</a><ul><li><a href="#21分页方法概述" class="table-of-contents__link toc-highlight">2.1分页方法概述</a></li><li><a href="#22分页查询条件" class="table-of-contents__link toc-highlight">2.2分页查询条件</a></li><li><a href="#23-控制分页规格" class="table-of-contents__link toc-highlight">2.3 控制分页规格</a></li><li><a href="#24-获得查询数据" class="table-of-contents__link toc-highlight">2.4 获得查询数据</a></li></ul></li><li><a href="#3jpaspecifcationexecutor接口-1" class="table-of-contents__link toc-highlight">3.JpaSpecifcationExecutor接口</a></li><li><a href="#4querydsl-1" class="table-of-contents__link toc-highlight">4.QueryDsL</a></li><li><a href="#1多表关联的含义" class="table-of-contents__link toc-highlight">1.多表关联的含义</a></li><li><a href="#2数据库表介绍" class="table-of-contents__link toc-highlight">2.数据库表介绍</a></li><li><a href="#3一对一关系" class="table-of-contents__link toc-highlight">3.一对一关系</a><ul><li><a href="#31-joincolumn" class="table-of-contents__link toc-highlight">3.1 @JoinColumn</a></li><li><a href="#32-onetoone" class="table-of-contents__link toc-highlight">3.2 @OneToOne</a></li><li><a href="#33-单向关联与双向关联" class="table-of-contents__link toc-highlight">3.3 单向关联与双向关联</a></li><li><a href="#34-双向关联的循环引用问题" class="table-of-contents__link toc-highlight">3.4 双向关联的循环引用问题</a></li></ul></li><li><a href="#4多对一一对多" class="table-of-contents__link toc-highlight">4.多对一/一对多</a><ul><li><a href="#41-manytoone" class="table-of-contents__link toc-highlight">4.1 @ManyToOne</a></li><li><a href="#42-onetomany" class="table-of-contents__link toc-highlight">4.2 @OneToMany</a></li></ul></li><li><a href="#5多对多关系" class="table-of-contents__link toc-highlight">5.多对多关系</a><ul><li><a href="#51-manytomany" class="table-of-contents__link toc-highlight">5.1 @ManyToMany</a></li><li><a href="#52-jointable" class="table-of-contents__link toc-highlight">5.2 @JoinTable</a></li></ul></li><li><a href="#1级联的含义" class="table-of-contents__link toc-highlight">1.级联的含义</a></li><li><a href="#2级联新增" class="table-of-contents__link toc-highlight">2.级联新增</a><ul><li><a href="#21单向关联的级联新增" class="table-of-contents__link toc-highlight">2.1单向关联的级联新增</a></li><li><a href="#23双向关联的级联新增" class="table-of-contents__link toc-highlight">2.3双向关联的级联新增</a></li><li><a href="#24多对多关联的级联新增" class="table-of-contents__link toc-highlight">2.4多对多关联的级联新增</a></li></ul></li><li><a href="#3级联删除" class="table-of-contents__link toc-highlight">3.级联删除</a><ul><li><a href="#31单向关联的级联删除" class="table-of-contents__link toc-highlight">3.1单向关联的级联删除</a></li><li><a href="#32-双向关联的级联删除" class="table-of-contents__link toc-highlight">3.2 双向关联的级联删除</a></li><li><a href="#33多对多关联的级联删除" class="table-of-contents__link toc-highlight">3.3多对多关联的级联删除</a></li></ul></li><li><a href="#4级联更新" class="table-of-contents__link toc-highlight">4.级联更新</a><ul><li><a href="#41单向关联的级联修改" class="table-of-contents__link toc-highlight">4.1单向关联的级联修改</a></li><li><a href="#42-双向关联的级联修改" class="table-of-contents__link toc-highlight">4.2 双向关联的级联修改</a></li><li><a href="#43多对多关联的级联修改" class="table-of-contents__link toc-highlight">4.3多对多关联的级联修改</a></li></ul></li><li><a href="#5总结" class="table-of-contents__link toc-highlight">5.总结</a></li><li><a href="#1审计的含义" class="table-of-contents__link toc-highlight">1.审计的含义</a></li><li><a href="#2开启审计" class="table-of-contents__link toc-highlight">2.开启审计</a></li><li><a href="#3监听实体" class="table-of-contents__link toc-highlight">3.监听实体</a><ul><li><a href="#31-entitylisteners" class="table-of-contents__link toc-highlight">3.1 @EntityListeners</a></li><li><a href="#32-监听器类" class="table-of-contents__link toc-highlight">3.2 监听器类</a></li></ul></li><li><a href="#4跟踪创建时间和修改时间" class="table-of-contents__link toc-highlight">4.跟踪创建时间和修改时间</a><ul><li><a href="#41-createddate" class="table-of-contents__link toc-highlight">4.1 @CreatedDate</a></li><li><a href="#42-lastmodifeddate" class="table-of-contents__link toc-highlight">4.2 @LastModifedDate</a></li><li><a href="#43-测试" class="table-of-contents__link toc-highlight">4.3 测试</a></li></ul></li><li><a href="#5跟踪创建人和修改人" class="table-of-contents__link toc-highlight">5.跟踪创建人和修改人</a><ul><li><a href="#51-createdby" class="table-of-contents__link toc-highlight">5.1 @CreatedBy</a></li><li><a href="#52-lastmodifedby" class="table-of-contents__link toc-highlight">5.2 @LastModifedBy</a></li><li><a href="#53-auditoraware接" class="table-of-contents__link toc-highlight">5.3 AuditorAware接</a></li><li><a href="#54测试" class="table-of-contents__link toc-highlight">5.4测试</a></li></ul></li><li><a href="#6自定义监听器" class="table-of-contents__link toc-highlight">6.自定义监听器</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 不要葱花博客 Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>